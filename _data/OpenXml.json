{"Data":{"Sdk":{"Events":[{"Id":"4559147447","Type":"IssuesEvent","CreatedAt":"2025-11-09T14:17:14","Actor":"koviroli","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1972","RelatedDescription":"Opened issue \"SpreadsheetDocument.Save() throws OpenXmlPackageException when saving .xlsb file due to unexpected styles.bin content type\" (#1972) at dotnet/Open-XML-SDK","RelatedBody":"\n### Describe the bug\n\nSaving an `.xlsb` opened via `SpreadsheetDocument` throws an `OpenXmlPackageException` about an unexpected content type for `/xl/styles.bin`. This occurs even if no modifications are made; simply opening and calling `Save()` triggers the error for `.xlsb`. The same code path works for `.xlsx` and `.xlsm`.\n\n### Exception\n\n```\nDocumentFormat.OpenXml.Packaging.OpenXmlPackageException: 'The document cannot be opened because there is an invalid part with an unexpected content type. \n[Part Uri=/xl/styles.bin], \n[Content Type=application/vnd.ms-excel.styles], \n[Expected Content Type=application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml].'\n```\n\n\nA temporary workaround is to force-get all public properties of the SpreadsheetDocument instance before saving; after doing so, Save() succeeds.\n\n### Screenshots\n\nN/A\n\n### To Reproduce\n\nA self-contained, minimal repro (console app):\n\n```\nusing DocumentFormat.OpenXml.Packaging;\n\nvar filePath = @\"PathToXlsb\\Book1.xlsm\";\nvar fileBytes = File.ReadAllBytes(filePath);\n\n\nvar stream = new MemoryStream();\nstream.Write(fileBytes, 0, fileBytes.Length);\nstream.Position = 0;\n\nusing var spreadsheetDocument = SpreadsheetDocument.Open(stream, true);\n\n// works with this solution\n//foreach (var prop in spreadsheetDocument.GetType().GetProperties())\n//{\n//    try\n//    {\n//        _ = prop.GetValue(spreadsheetDocument);\n//    }\n//    catch { }\n//}\n\n// Throws exception\nspreadsheetDocument.Save();\n```\n\n\n### Steps\n\n1. Open any `.xlsb` file with `SpreadsheetDocument.Open(stream, true)`.\n2. Immediately call `spreadsheetDocument.Save()`.\n3. Observe the `OpenXmlPackageException`.\n\n### Observed behavior\n\nAccessing all public properties on `SpreadsheetDocument` prior to saving (reflection-based getter loop) makes the save succeed.\n\n### Expected behavior\n\nOpening a valid `.xlsb` file, optionally modifying custom properties, and calling `Save()` should succeed without requiring any reflection-based workarounds.\n\n### Desktop (please complete the following information)\n\n- OS: Windows 11 Home (26100.2033)\n- Office version: N/A (repro does not require Office; opening/saving via SDK)\n- .NET Target: .NET 8 and .NET 10 (both reproduce)\n- DocumentFormat.OpenXml Version(s) tested: 3.3.0, 3.2.0, 3.1.1, 3.0.2, 3.0.1\n\n### Additional context\n\n- Only happens with `.xlsb`. The same code works for `.xlsx` and `.xlsm`.\n- The behavior cannot be reproduced with `WordprocessingDocument` or `PresentationDocument` for their respective formats.\n- The workaround (calling getters for all public properties on `SpreadsheetDocument`) suggests a lazy-loading/initialization or part registration issue specific to `.xlsb` styles content types."},{"Id":"4486889423","Type":"IssuesEvent","CreatedAt":"2025-11-05T19:09:35","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1944","RelatedDescription":"Closed issue \"Obsolete PivotCacheDynamicArray class\" (#1944) at dotnet/Open-XML-SDK","RelatedBody":"CT_PivotCacheDynamicArrayExt has been removed in the latest schema update so PivotCacheDynamicArray should be obsoleted until it can be removed in v4"},{"Id":"4486889283","Type":"IssuesEvent","CreatedAt":"2025-11-05T19:09:35","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1946","RelatedDescription":"Closed issue \"Obsolete PivotCacheRichInfo\" (#1946) at dotnet/Open-XML-SDK","RelatedBody":"CT_PivotCacheRichInfo is odoc:omit=\"true\" but it failed, so PivotCacheRichInfo should be obsoleted then removed in v4"},{"Id":"4473686824","Type":"IssuesEvent","CreatedAt":"2025-11-05T09:55:08","Actor":"PeterAyad","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1971","RelatedDescription":"Opened issue \"'Specified part does not exist' error message is not helpful\" (#1971) at dotnet/Open-XML-SDK","RelatedBody":"I am trying to open this file [testFile.docx](https://docs.google.com/document/d/1VVVcLk07EujdzBI9jTHSdYv5pP6mBOyw/edit?usp=drive_link&ouid=109338977916725867907&rtpof=true&sd=true)\n\nusing the code\n\n```c#\n static void Main(string[] args)\n {\n     try\n     {\n         using (WordprocessingDocument doc = WordprocessingDocument.Open(\"testFile.docx\", false))\n         {\n             Console.WriteLine(\"File is opened!\");\n         }\n     }\n     catch (Exception ex)\n     {\n         Console.WriteLine(\"General Exception caught:\");\n         Console.WriteLine($\"Type: {ex.GetType()}\");\n         Console.WriteLine($\"Message: {ex.Message}\");\n         Console.WriteLine($\"StackTrace: {ex.StackTrace}\");\n     }\n }\n```\n\nBut I am getting this message which isn't helpful\n\n> General Exception caught:\n> Type: System.InvalidOperationException\n> Message: Specified part does not exist in the package.\n> StackTrace:    at System.IO.Packaging.Package.GetPart(Uri partUri)\n>    at DocumentFormat.OpenXml.Features.PackageFeatureBase.DocumentFormat.OpenXml.Packaging.IPackage.GetPart(Uri uriTarget)\n>    at DocumentFormat.OpenXml.Packaging.PackageUriHandlingExtensions.MalformedUriHandlingPackage.GetPart(Uri uriTarget)\n>    at DocumentFormat.OpenXml.Packaging.OpenXmlPart.Load(OpenXmlPackage openXmlPackage, OpenXmlPart parent, Uri uriTarget, String id)\n>    at DocumentFormat.OpenXml.Packaging.PartRelationshipsFeature.LoadReferencedPartsAndRelationships()\n>    at DocumentFormat.OpenXml.Packaging.PartRelationshipsFeature.DocumentFormat.OpenXml.Features.IReferenceRelationshipsFeature.get_Relationships()\n>    at DocumentFormat.OpenXml.Packaging.OpenXmlPartContainer.get_ExternalRelationships()\n>    at Demo.Program.Main(String[] args) in ...\n\nIs there a way to find which part is missing?"},{"Id":"4461124237","Type":"IssuesEvent","CreatedAt":"2025-11-04T19:51:51","Actor":"dandesro71","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1970","RelatedDescription":"Opened issue \"With .NET 10, when opening an document with PNG images and close it, some images have zero size in media folder\" (#1970) at dotnet/Open-XML-SDK","RelatedBody":"I'm using version 3.3\n\nWith .NET 10, when opening an document already formed with PNG images (2 or 3) and close it, some images have zero size in media folder after disposing. The first one is generally untouched, but the other ones are all empty.\n\nThe same document in .NET 9 behave correctly (images are not empty).\n\n\n"},{"Id":"4457789445","Type":"PullRequestEvent","CreatedAt":"2025-11-04T17:03:13","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":null,"RelatedDescription":"Opened pull request \"\" (#1969) at dotnet/Open-XML-SDK","RelatedBody":null}],"ResultType":"GitHubEvent"}},"RunOn":"2025-11-10T03:30:24.0792846Z","RunDurationInMilliseconds":777}