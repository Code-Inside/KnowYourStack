{"Data":{"Sdk":{"Events":[{"Id":"34667490010","Type":"IssuesEvent","CreatedAt":"2024-01-09T02:35:14","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1636","RelatedDescription":"Closed issue \"Bug with Open XML SDK v3.0 and excels with malformed hyperlinks \" (#1636) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\r\nGetting the root element of a `WorkbookPart` of an excel with invalid hyperlinks causes the following exception:\r\n```\r\nSystem.ObjectDisposedException: Cannot access a closed stream.\r\nObject name: 'DeflateStream'.\r\n   at System.IO.Compression.DeflateStream.<EnsureNotDisposed>g__ThrowStreamClosedException|42_0()\r\n   at System.IO.Compression.DeflateStream.ReadCore(Span`1 buffer)\r\n   at System.IO.Compression.DeflateStream.Read(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.IO.Packaging.ZipWrappingStream.Read(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.Xml.XmlTextReaderImpl.InitStreamInput(Uri baseUri, String baseUriStr, Stream stream, Byte[] bytes, Int32 byteCount, Encoding encoding)\r\n   at System.Xml.XmlTextReaderImpl.FinishInitStream()\r\n   at System.Xml.XmlTextReaderImpl..ctor(Stream stream, Byte[] bytes, Int32 byteCount, XmlReaderSettings settings, Uri baseUri, String baseUriStr, XmlParserContext context, Boolean closeInput)\r\n   at System.Xml.XmlReaderSettings.CreateReader(Stream input, Uri baseUri, String baseUriString, XmlParserContext inputContext)\r\n   at System.Xml.XmlReader.Create(Stream input, XmlReaderSettings settings)\r\n   at DocumentFormat.OpenXml.XmlConvertingReaderFactory.Create(Stream partStream, IOpenXmlNamespaceResolver resolver, XmlReaderSettings settings, Boolean strictRelationshipFound)\r\n   at DocumentFormat.OpenXml.OpenXmlPartRootElement.LoadFromPart(OpenXmlPart openXmlPart, Stream partStream)\r\n   at DocumentFormat.OpenXml.Packaging.OpenXmlPart.LoadDomTree[T]()\r\n   at DocumentFormat.OpenXml.Packaging.WorkbookPart.get_Workbook()\r\n   at DocumentFormat.OpenXml.Packaging.WorkbookPart.get_PartRootElement()\r\n   at DocumentFormat.OpenXml.Packaging.OpenXmlPart.get_RootElement()\r\n``` \r\nOpening the .xlsx file with excel, selecting all columns and clicking `remove hyperlinks` solves the problem.\r\n\r\n**To Reproduce**\r\n```\r\nclass Program\r\n{\r\n    private static async Task Main(string[] args)\r\n    {\r\n        var excelParser = new ExcelParser(NullLogger<ExcelParser>.Instance);\r\n        var excels = Directory.GetFiles(@\"Excels\", \"*.xlsx\");\r\n        await using var stream = File.OpenRead(excels.FirstOrDefault()); // this is the excel (believe me ;))\r\n        await excelParser.ToolsFromExcelTask(stream);\r\n    }\r\n}\r\n\r\n\r\n  public ValueTask<ICollection<ToolModel>> ToolsFromExcelTask(Stream excelStream)\r\n    {\r\n        using var spreadSheetDocument = SpreadsheetDocument.Open(excelStream, false);\r\n        var workbookPart =  spreadSheetDocument.WorkbookPart;\r\n\r\n\r\n        /*\r\n         *  Bug lies somewhere in the following line, it throws an ObjectDisposedException\r\n         *  on some excels (not all)\r\n         */\r\n        var sheets = workbookPart.RootElement.GetFirstChild<Sheets>().Elements<Sheet>().ToList();\r\n      \r\n        var sharedStringTable = workbookPart.SharedStringTablePart?.SharedStringTable;\r\n        ........\r\n}\r\n```\r\n\r\nSteps to reproduce the behavior:\r\nMove the excel with the malformed hyperlinks to \"Excels\".\r\nRun the following code.\r\nSee error.\r\nNote: in practice, i tried it on many files, with some it worked others not so much...\r\nwith 3-4 files it seems to always happen with the same ones, when I tested with many many files I couldn't really point it to specific files.\r\n\r\n**Observed behavior**\r\nThrew an error.\r\n\r\n**Expected behavior**\r\nNot to.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOs 14.2.1\r\n - Office version 16.80\r\n - .NET Target: .NET Core 8 (tried with 6 also)\r\n - DocumentFormat.OpenXml Version: 3.0.0\r\n\r\n**Additional context**\r\nWhen I ran the same program with OpenXml 2.2 it threw UriMalformed (or something like that) and crashed at \r\n`using var spreadSheetDocument = SpreadsheetDocument.Open(excelStream, false);`\r\n\r\nOpening the .xlsx file with excel, selecting all columns and clicking `remove hyperlinks` solves the problem.\r\nthe hyperlinks are in the format of `som_e_thing_@LIK_th is` \r\nI can't attach the files I tested with, sorry.\r\n\r\nMight be related to Add better support for malformed URIs #1322"},{"Id":"34667489759","Type":"PullRequestEvent","CreatedAt":"2024-01-09T02:35:13","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1644","RelatedDescription":"Merged pull request \"Check for seekable stream for malformed uri handling\" (#1644) at dotnet/Open-XML-SDK","RelatedBody":"- We must be able to seek to create a temporary file requried for uri handling\n- We should throw the same exception we did in v2.x\n- If compat mode is on, this will throw at open time (i.e. it will eagerly load everything)\n\nFixes #1636\n"},{"Id":"34665759041","Type":"PullRequestEvent","CreatedAt":"2024-01-09T00:38:35","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1644","RelatedDescription":"Opened pull request \"Check for seekable stream for malformed uri handling\" (#1644) at dotnet/Open-XML-SDK","RelatedBody":"- We must be able to seek to create a temporary file requried for uri handling\n- We should throw the same exception we did in v2.x\n- If compat mode is on, this will throw at open time (i.e. it will eagerly load everything)\n\nFixes #1636\n"},{"Id":"34664990138","Type":"PullRequestEvent","CreatedAt":"2024-01-08T23:45:06","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1643","RelatedDescription":"Merged pull request \"Hide package builder types\" (#1643) at dotnet/Open-XML-SDK","RelatedBody":""},{"Id":"34663272569","Type":"PullRequestEvent","CreatedAt":"2024-01-08T22:03:03","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1643","RelatedDescription":"Opened pull request \"Hide package builder types\" (#1643) at dotnet/Open-XML-SDK","RelatedBody":""},{"Id":"34663152482","Type":"PullRequestEvent","CreatedAt":"2024-01-08T21:56:57","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1625","RelatedDescription":"Merged pull request \"Bump dawidd6/action-download-artifact from 2 to 3\" (#1625) at dotnet/Open-XML-SDK","RelatedBody":"Bumps [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact) from 2 to 3.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/dawidd6/action-download-artifact/releases\">dawidd6/action-download-artifact's releases</a>.</em></p>\n<blockquote>\n<h2>v3.0.0</h2>\n<p>Node was updated from 16 to 20.\nNode 20 requires <code>glibc&gt;=2.28</code>.</p>\n<h2>v2.28.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.27.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.26.1</h2>\n<p>No release notes provided.</p>\n<h2>v2.26.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.25.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.24.4</h2>\n<p>No release notes provided.</p>\n<h2>v2.24.3</h2>\n<p>No release notes provided.</p>\n<h2>v2.24.2</h2>\n<p>No release notes provided.</p>\n<h2>v2.24.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.23.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.22.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.21.1</h2>\n<p>No release notes provided.</p>\n<h2>v2.21.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.20.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.19.0</h2>\n<p>No release notes provided.</p>\n<h2>v2.18.0</h2>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/e7466d1a7587ed14867642c2ca74b5bcc1e19a2d\"><code>e7466d1</code></a> build(deps): bump <code>@​actions/artifact</code> from 1.1.2 to 2.0.0 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/260\">#260</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/f29d1b6a8930683e80acedfbe6baa2930cd646b4\"><code>f29d1b6</code></a> node_modules: upgrade</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/587cee61f534dd8254d0baad7d7c511335afca24\"><code>587cee6</code></a> action: node16 -&gt; node20 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/259\">#259</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/1cf761fba652f5ee1570ccc23e3ab2123370f234\"><code>1cf761f</code></a> build(deps): bump undici from 5.25.4 to 5.28.2 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/258\">#258</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/d44631c448e18ab4dc3ebf7dd43489e1afeaee61\"><code>d44631c</code></a> build(deps): bump <code>@​actions/github</code> from 5.1.1 to 6.0.0 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/252\">#252</a>)</li>\n<li>See full diff in <a href=\"https://github.com/dawidd6/action-download-artifact/compare/v2...v3\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=dawidd6/action-download-artifact&package-manager=github_actions&previous-version=2&new-version=3)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>"},{"Id":"34663145438","Type":"PullRequestEvent","CreatedAt":"2024-01-08T21:56:34","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1640","RelatedDescription":"Closed pull request \"Add public apis\" (#1640) at dotnet/Open-XML-SDK","RelatedBody":""},{"Id":"34663142397","Type":"PullRequestEvent","CreatedAt":"2024-01-08T21:56:25","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1642","RelatedDescription":"Merged pull request \"Add back package validation\" (#1642) at dotnet/Open-XML-SDK","RelatedBody":""}],"ResultType":"GitHubEvent"}},"RunOn":"2024-01-09T03:30:23.0276928Z","RunDurationInMilliseconds":653}