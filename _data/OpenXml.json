{"Data":{"Sdk":{"Events":[{"Id":"28450708922","Type":"IssuesEvent","CreatedAt":"2023-04-16T23:52:06","Actor":"tomjebo","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1318","RelatedDescription":"Closed issue \"AddEmbeddedPackagePart is saved to wrong path\" (#1318) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\r\n\r\n_ISSUE 1_\r\n\r\nYou can iterate all EmbeddedPackageParts by doing the below. It iterates WorksheetParts and then each EmbeddedPackagePart.\r\n```\r\nusing (SpreadsheetDocument spreadsheet = SpreadsheetDocument.Open(filepath, true))\r\n{\r\n    IEnumerable<WorksheetPart> worksheetParts = spreadsheet.WorkbookPart.WorksheetParts;\r\n    foreach (WorksheetPart worksheetPart in worksheetParts)\r\n    {\r\n        IEnumerable<EmbeddedPackagePart> embedpackages = worksheetPart.EmbeddedPackageParts;\r\n        foreach (EmbeddedPackagePart part in embedpackages)\r\n        {\r\n\r\n        }\r\n    }\r\n}\r\n```\r\nYou can delete any EmbeddedPackagePart by deleting it at the WorksheetPart level like this.\r\n```\r\nworksheetPart.DeletePart(part);\r\n```\r\n\r\nHowever, if you want to AddEmbeddedPackagePart you can do so also at the WorksheetPart level:\r\n```\r\nEmbeddedPackagePart embedpack = worksheetPart.AddEmbeddedPackagePart(contentType);\r\n```\r\nBut the new EmbeddedPackagePart will be saved to this URI where a new ```embeddings``` folder will be created:\r\n```\r\nxl/worksheets/embeddings/package.bin\r\n```\r\nIf you use Excel, all EmbeddedPackageParts are saved in this folder instead:\r\n```\r\nxl/embeddings/package.bin\r\n```\r\n\r\nIs this correct behaviour? Should Open XML SDK also save the part to ```xl/embeddings```?\r\n\r\n_ISSUE 2:_\r\n\r\nExcel saves the EmbeddedPackagePart with original extension i.e. ```.xlsx```.\r\n\r\nOpen XML SDK saves EmbeddedPackagePart with ```.bin``` extension.\r\n\r\n**Observed behavior**\r\n1. EmbeddedPackagePart is saved to ```xl/worksheets/embeddings```\r\n\r\n2. EmbeddedPackagePart is saved with ```.bin``` extension.\r\n\r\n**Expected behavior**\r\n1. EmbeddedPackagePart should be saved to ```xl/embeddings```\r\n\r\n2. EmbeddedPackagePart should be saved with the original extension of the package i.e. ```.xlsx```.\r\n\r\n**Desktop (please complete the following information):**\r\n* OS: Windows 11\r\n* Office version: 2212\r\n* .NET Target: .Net latest version\r\n* DocumentFormat.OpenXml Version: 2.19\r\n\r\n\r\n"},{"Id":"28450664254","Type":"IssuesEvent","CreatedAt":"2023-04-16T23:44:37","Actor":"tomjebo","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1406","RelatedDescription":"Opened issue \"Investigate ITargetFeature use to redirect target path for EmbeddedPackage and EmbeddedObject (and other) parts.\" (#1406) at dotnet/Open-XML-SDK","RelatedBody":"From #1318.\r\n\r\nTLDR:\r\nWe should investigate using the features (perhaps ITargetFeature) to customize added parts like `EmbeddedPackagePart` and `ImagePart` where the target path was specified as a compromise between the apps' specific structures so that we can mimic Excel, Word and PowerPoint's exact targeting behaviors.\r\n\r\nMORE: \r\n\r\nI was looking at this and I see why `EmbeddedPackagePart`s are saved to a new `embeddings` folder in the folder of the referencing part. `EmbeddedPackagePart` is a shared type in ISO 29500-1. That means that it is a target of an explicit relationship of several parts in WordprocessingML, SpreadsheetML and PresentationML documents. However, these documents don't have the same structures wrt where those referencing parts live path-wise.  So when the SDK designers were considering how to declaratively specify using XML definitions with a targetPath specification like `embeddings` or `../embeddings` or `/embeddings`, they couldn't come up with one that would satisfy all three apps. For Excel, it would be `../embeddings` but for Word it would be `./embeddings` or just `embeddings`. And PowerPoint is one of those two options. So the alternative was to write front end code or generate more back end code for the front end to mimic the behavior of the three apps. When considering this with all the other behaviors that don't actually impact the consumption of the package by those apps, they opted to just pick one, effectively `./embeddings`, and call it a day. I'm sure there are tons of other behaviors like this in the SDK. \"Correcting\" them all to mimic Office exactly starts to bloat the SDK and approach a large codebase like the apps themselves.  \r\n\r\nUsing features: \r\n\r\nI see that we generate: \r\n\r\n```csharp\r\n        private sealed class GeneratedFeatures : TypedPartFeatureCollection, ITargetFeature\r\n        {\r\n            public GeneratedFeatures(OpenXmlPart part) : base(part) { }\r\n            string ITargetFeature.Extension => \".bin\";\r\n            string ITargetFeature.Name => \"image\";\r\n            string ITargetFeature.Path => \"../media\";\r\n        }\r\n```\r\n\r\nSo perhaps we can use ITargetFeature to customize this behavior."},{"Id":"28449612534","Type":"PullRequestEvent","CreatedAt":"2023-04-16T20:59:14","Actor":"tomjebo","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1394","RelatedDescription":"Closed pull request \"refactor addembeddedpackage and object methods to use one extension method \" (#1394) at dotnet/Open-XML-SDK","RelatedBody":"First draft WIP, some names will change after looking at the ImagePart extension and other that get generated in parts."},{"Id":"28448519670","Type":"PullRequestEvent","CreatedAt":"2023-04-16T18:21:05","Actor":"tomjebo","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1405","RelatedDescription":"Opened pull request \"consolidate add part methods (e.g. AddEmbeddedPackage) to use one Initpart extension\" (#1405) at dotnet/Open-XML-SDK","RelatedBody":"This is a new \"clean\" PR based off main with the #1387 changes reverted via #1404. "},{"Id":"28448247924","Type":"PullRequestEvent","CreatedAt":"2023-04-16T17:45:08","Actor":"tomjebo","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1404","RelatedDescription":"Merged pull request \"revert the changes from #1387 addembeddedpackage change\" (#1404) at dotnet/Open-XML-SDK","RelatedBody":"this PR reverts the AddEmbeddedObject and PackagePart changes from #1387"},{"Id":"28447868311","Type":"PullRequestEvent","CreatedAt":"2023-04-16T16:55:12","Actor":"tomjebo","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1404","RelatedDescription":"Opened pull request \"revert the changes from #1387 addembeddedpackage change\" (#1404) at dotnet/Open-XML-SDK","RelatedBody":"this PR reverts the AddEmbeddedObject and PackagePart changes from #1387"},{"Id":"28441254815","Type":"PullRequestEvent","CreatedAt":"2023-04-15T23:37:02","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1403","RelatedDescription":"Merged pull request \"Remove TypedOpenXmlPackage\" (#1403) at dotnet/Open-XML-SDK","RelatedBody":""},{"Id":"28433616266","Type":"PullRequestEvent","CreatedAt":"2023-04-15T03:31:40","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1403","RelatedDescription":"Opened pull request \"Remove TypedOpenXmlPackage\" (#1403) at dotnet/Open-XML-SDK","RelatedBody":""},{"Id":"28433587286","Type":"PullRequestEvent","CreatedAt":"2023-04-15T03:26:06","Actor":"twsouthwick","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1401","RelatedDescription":"Merged pull request \"Remove Typed[Package/Part/etc]\" (#1401) at dotnet/Open-XML-SDK","RelatedBody":"This was helpful for a while, but things have been refactored enough we\ndon't need a specific layer for this anymore. This will make it simpler\nto break the Excel/Word/PowerPoint packages out to their own assemblies\nas well.\n"}],"ResultType":"GitHubEvent"}},"RunOn":"2023-04-18T03:30:26.5231235Z","RunDurationInMilliseconds":802}