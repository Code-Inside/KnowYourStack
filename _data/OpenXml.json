{"Data":{"Sdk":{"Events":[{"Id":"4655356016","Type":"IssuesEvent","CreatedAt":"2025-11-13T13:04:59","Actor":"mliotta","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1973","RelatedDescription":"Opened issue \"API Proposal: Formula Evaluation Feature\" (#1973) at dotnet/Open-XML-SDK","RelatedBody":"# API Proposal: Formula Evaluation Feature for Open XML SDK\n\n## Summary\n\nThis proposal introduces a comprehensive formula evaluation feature for the Open XML SDK, enabling applications to evaluate Excel formulas programmatically without requiring Excel to be installed. The feature supports 508 of Excel's 522 built-in functions (97.3% coverage) with native .NET performance through expression tree compilation.\n\n## Motivation\n\n### Problem Statement\n\nCurrently, the Open XML SDK can read and write Excel formulas as text, but cannot evaluate them. This creates several challenges:\n\n1. **Applications that generate Excel files** must either:\n   - Leave cached values empty (causing Excel to show `#N/A` until recalculation)\n   - Implement formula evaluation from scratch (complex, error-prone)\n   - Require Excel installation for automation (licensing issues, deployment complexity)\n\n2. **Applications reading Excel files** cannot:\n   - Validate formula results without Excel\n   - Process formula-dependent data programmatically\n   - Build data pipelines that depend on calculated values\n\n3. **Testing and validation** scenarios:\n   - No way to unit test formula logic in generated spreadsheets\n   - Cannot validate formula correctness programmatically\n   - Difficult to detect formula errors early in CI/CD pipelines\n\n### Use Cases\n\n**Data Generation Services**\n```csharp\n// Generate a report with calculated columns\nvar worksheet = CreateReportWorksheet();\nvar evaluator = document.AddFormulaEvaluator();\n\n// Add formulas\nworksheet.GetCell(\"D2\").CellFormula = new CellFormula(\"B2*C2\");\nworksheet.GetCell(\"D3\").CellFormula = new CellFormula(\"B3*C3\");\n\n// Calculate and cache values before saving\nevaluator.RecalculateSheet(worksheet);\n// Excel will now show correct values immediately when opened\n```\n\n**Incremental Recalculation**\n```csharp\n// User updates a cell in a large spreadsheet\nUpdateCellValue(\"A1\", 42);\n\n// Only recalculate affected cells (much faster than full recalc)\nevaluator.RecalculateDependents(worksheet, \"A1\");\n```\n\n**Formula Validation and Testing**\n```csharp\n// Validate generated formulas produce expected results\nvar result = evaluator.TryEvaluate(worksheet, cell);\nAssert.True(result.IsSuccess);\nAssert.Equal(expectedValue, result.Value.NumericValue);\n```\n\n**Dependency Analysis**\n```csharp\n// Understand formula dependencies for change impact analysis\nvar graph = evaluator.GetDependencyGraph(worksheet);\nvar dependents = graph.GetDependents(\"A1\"); // What cells depend on A1?\n```\n\n## Proposed API\n\n### Core Feature Interface\n\n```csharp\nnamespace DocumentFormat.OpenXml.Features.FormulaEvaluation;\n\n/// <summary>\n/// Feature interface for formula evaluation.\n/// </summary>\npublic interface IFormulaEvaluator : IDisposable\n{\n    /// <summary>\n    /// Evaluates a single cell formula.\n    /// </summary>\n    Result<CellValue> TryEvaluate(Worksheet worksheet, Cell cell);\n\n    /// <summary>\n    /// Recalculates all formulas in the worksheet in dependency order.\n    /// </summary>\n    void RecalculateSheet(Worksheet worksheet);\n\n    /// <summary>\n    /// Recalculates only formulas that depend on changed cells.\n    /// This is significantly faster than RecalculateSheet for incremental updates.\n    /// </summary>\n    void RecalculateDependents(Worksheet worksheet, params string[] changedCells);\n\n    /// <summary>\n    /// Gets the dependency graph for the worksheet.\n    /// </summary>\n    IDependencyGraph GetDependencyGraph(Worksheet worksheet);\n\n    /// <summary>\n    /// Gets evaluation statistics.\n    /// </summary>\n    EvaluatorStatistics GetStatistics();\n\n    /// <summary>\n    /// Checks if a function is supported.\n    /// </summary>\n    bool IsFunctionSupported(string functionName);\n\n    /// <summary>\n    /// Gets the set of supported function names.\n    /// </summary>\n    HashSet<string> SupportedFunctions { get; }\n}\n```\n\n### Supporting Types\n\n```csharp\n/// <summary>\n/// Represents a cell value with its type.\n/// </summary>\npublic readonly struct CellValue : IEquatable<CellValue>\n{\n    public CellValueType Type { get; }\n    public double NumericValue { get; }\n    public string StringValue { get; }\n    public bool BoolValue { get; }\n    public bool IsError { get; }\n    public string? ErrorValue { get; }\n\n    public static CellValue FromNumber(double value);\n    public static CellValue FromString(string value);\n    public static CellValue FromBool(bool value);\n    public static CellValue Error(string error);\n    public static CellValue Empty { get; }\n}\n\n/// <summary>\n/// Cell value type enumeration.\n/// </summary>\npublic enum CellValueType\n{\n    Number,\n    Text,\n    Boolean,\n    Error,\n    Empty\n}\n\n/// <summary>\n/// Result type for formula evaluation operations.\n/// </summary>\npublic readonly struct Result<T>\n{\n    public bool IsSuccess { get; }\n    public T Value { get; }\n    public EvaluationError? Error { get; }\n\n    public static Result<T> Success(T value);\n    public static Result<T> Failure(EvaluationError error);\n    public TResult Match<TResult>(\n        Func<T, TResult> onSuccess,\n        Func<EvaluationError, TResult> onFailure);\n}\n\n/// <summary>\n/// Base class for evaluation errors.\n/// </summary>\npublic abstract class EvaluationError : Exception\n{\n    public string? CellReference { get; }\n}\n\n// Specific error types\npublic class ParserException : EvaluationError { }\npublic class CompilationException : EvaluationError { }\npublic class UnsupportedFunctionException : EvaluationError\n{\n    public string FunctionName { get; }\n}\npublic class CircularReferenceException : EvaluationError\n{\n    public List<string> CellChain { get; }\n}\npublic class InvalidReferenceException : EvaluationError\n{\n    public string Reference { get; }\n}\n\n/// <summary>\n/// Statistics about formula evaluation performance.\n/// </summary>\npublic class EvaluatorStatistics\n{\n    public long TotalEvaluations { get; }\n    public long SuccessfulEvaluations { get; }\n    public long FailedEvaluations { get; }\n    public double SuccessRate { get; }\n    public int CompiledFormulaCount { get; }\n    public int SupportedFunctionCount { get; }\n    public double AvgEvaluationTimeMicros { get; }\n}\n\n/// <summary>\n/// Dependency graph interface.\n/// </summary>\npublic interface IDependencyGraph\n{\n    void AddCell(string cellRef, IEnumerable<string> dependencies);\n    IEnumerable<string> GetDependents(string cellRef);\n    IEnumerable<string> GetEvaluationOrder();\n    IEnumerable<string> GetEvaluationOrder(IEnumerable<string> cellSubset);\n}\n```\n\n### Extension Method for Easy Access\n\n```csharp\nnamespace DocumentFormat.OpenXml.Packaging;\n\npublic static class FormulaEvaluatorExtensions\n{\n    /// <summary>\n    /// Adds formula evaluation capability to the document.\n    /// </summary>\n    public static IFormulaEvaluator AddFormulaEvaluator(\n        this SpreadsheetDocument document)\n    {\n        return new FormulaEvaluator(document);\n    }\n}\n```\n\n## Architecture and Implementation\n\n### 4-Layer Design\n\n1. **Parser** - Converts formula text to Abstract Syntax Tree (AST)\n   - Handles all Excel formula syntax including references, operators, functions\n   - Supports absolute/relative references, ranges, named ranges\n\n2. **Compiler** - Converts AST to .NET Expression Trees\n   - Compiles to native code via `Expression<T>.Compile()`\n   - Formulas cached by text for reuse (compile once, evaluate many times)\n\n3. **Evaluator** - Orchestrates evaluation with proper semantics\n   - Handles cell lookups, shared string table, number formats\n   - Manages evaluation context and error propagation\n\n4. **Dependency Graph** - Topological sort for correct evaluation order\n   - Detects and reports circular references\n   - Enables incremental recalculation (only evaluate affected cells)\n   - Uses Kahn's algorithm for topological sorting\n\n### Performance Characteristics\n\n- **Compilation**: 0.5-2ms per unique formula (one-time cost)\n- **Evaluation**: 0.01-0.1ms per evaluation (after compilation)\n- **Incremental Recalc**: 250-1000x faster than full sheet recalculation\n- **Memory**: Formulas cached by text; ~1KB per unique formula compiled\n\n### Function Coverage\n\n**508 of 522 Excel functions supported (97.3%)**\n\nSupported categories:\n- ✅ Math & Trigonometry (88 functions) - SUM, AVERAGE, COUNT, ROUND, SIN, COS, etc.\n- ✅ Logical (10 functions) - IF, AND, OR, NOT, IFS, SWITCH, etc.\n- ✅ Text (56 functions) - CONCATENATE, LEFT, RIGHT, MID, FIND, TEXT, REGEX*, etc.\n- ✅ Lookup & Reference (24 functions) - VLOOKUP, HLOOKUP, INDEX, MATCH, XLOOKUP, etc.\n- ✅ Array (17 functions) - FILTER, SORT, UNIQUE, SEQUENCE, TRANSPOSE, etc.\n- ✅ Date & Time (25 functions) - TODAY, NOW, DATE, YEAR, MONTH, WEEKDAY, etc.\n- ✅ Statistical (112 functions) - MEDIAN, MODE, STDEV, VAR, FORECAST, TREND, etc.\n- ✅ Financial (55 functions) - PMT, FV, PV, NPV, IRR, XIRR, etc.\n- ✅ Engineering (52 functions) - CONVERT, HEX2DEC, COMPLEX, BESSELI, BITAND, etc.\n- ✅ Database (12 functions) - DSUM, DAVERAGE, DCOUNT, DGET, etc.\n- ✅ Information (20 functions) - ISNUMBER, ISTEXT, ISERROR, TYPE, etc.\n- ✅ Cube (7 functions) - CUBEVALUE, CUBEMEMBER, CUBESET, etc.\n- ✅ Web (3 functions) - WEBSERVICE, ENCODEURL, FILTERXML\n- ✅ Legacy Compatibility (24 functions) - BETADIST, NORMDIST, etc.\n\nMissing functions (14): Mostly obscure legacy functions or complex specialized functions (GETPIVOTDATA variations, some cube functions, etc.)\n\n## Testing and Validation\n\n### Oracle Validation Pattern\n\nWe've implemented comprehensive testing using Excel as the oracle:\n\n1. **Generate test file** with 650+ formula test cases covering all function categories\n2. **Open in Excel** and let it calculate all formulas (blessing the results)\n3. **Save blessed file** with Excel's calculated values\n4. **Compare** our evaluator's results against Excel's results\n\nCurrent test results:\n- 650+ test cases across all function categories\n- Validates simple to highly complex nested formulas (5+ nesting levels)\n- Tests edge cases, error conditions, and Excel-specific behaviors\n\n### Continuous Integration\n\nAll tests run on:\n- Windows (net8.0, net46, net35)\n- Linux (net8.0, netstandard2.0)\n- macOS (net8.0, netstandard2.0)\n\n## Breaking Changes\n\n**None.** This is a purely additive feature:\n- New package: `DocumentFormat.OpenXml.Formulas`\n- Does not modify existing SDK APIs\n- Opt-in via extension method: `document.AddFormulaEvaluator()`\n- No impact on applications that don't use the feature\n\n## Framework Support\n\nSupports all current SDK target frameworks:\n- ✅ .NET Framework 3.5, 4.0, 4.6\n- ✅ .NET Standard 2.0\n- ✅ .NET 8.0+\n\n## Open Questions for Review\n\n1. **API Design**\n   - Is the `IFormulaEvaluator` feature interface approach correct for SDK features?\n   - Should `CellValue` be in the main SDK namespace or formula-specific namespace?\n   - Is the `Result<T>` pattern appropriate, or should we use exceptions for evaluation failures?\n\n2. **Performance**\n   - Are the claimed performance characteristics sufficient for typical use cases?\n   - Should we provide async variants for long-running recalculations?\n\n3. **Function Coverage**\n   - Is 97.3% coverage (508/522 functions) sufficient for initial release?\n   - Should we document which functions are missing?\n   - How should we handle the 14 unsupported functions? (Currently throws `UnsupportedFunctionException`)\n\n4. **Incremental Delivery**\n   - Should this be released as experimental/preview first?\n   - Would a phased rollout (core functions first, advanced later) be better?\n\n5. **Dependency Graph**\n   - Should the dependency graph API be public or internal?\n   - Current implementation rebuilds graph on each recalc - is this acceptable or should we persist it?\n\n6. **Package Structure**\n   - Should this be a separate NuGet package (`DocumentFormat.OpenXml.Formulas`) or integrated into main package?\n   - Current proposal: Separate package to keep main SDK lightweight\n\n## Related Work\n\n- **ClosedXML**: Has formula evaluation but tightly coupled to their object model\n- **EPPlus**: Commercial formula evaluation but incompatible with Open XML SDK\n- **ExcelFormulaParser**: Parser only, no evaluation engine\n- **Jint/JavaScript engines**: Too heavy, different semantics than Excel\n\nThis proposal provides native .NET formula evaluation that:\n- Integrates seamlessly with Open XML SDK\n- Matches Excel's evaluation semantics precisely\n- Delivers native performance through expression compilation\n- Maintains SDK's philosophy of being lightweight and focused\n\n## Implementation Status\n\n- ✅ Complete implementation available\n- ✅ 650+ oracle-validated tests\n- ✅ Multi-framework compilation tested\n- ✅ Code reviewed for kernel-quality standards\n- ✅ Documentation complete\n\n**Repository**: Available at https://github.com/mliotta/Open-XML-SDK (fork)\n**Branch**: main\n**Commits**: Ready for review\n\n## References\n\n- Implementation: `/src/DocumentFormat.OpenXml.Formulas/`\n- Tests: `/test/DocumentFormat.OpenXml.Formulas.Tests/`\n- Oracle test file: 650+ test cases validated against Excel\n- Documentation: README.md with complete function reference\n"},{"Id":"4607532104","Type":"IssuesEvent","CreatedAt":"2025-11-11T17:28:36","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1635","RelatedDescription":"Closed issue \"Read sensitivity labelled documents\" (#1635) at dotnet/Open-XML-SDK","RelatedBody":"Add support for reading sensitivity labelled documents. As of today if document is labelled by sensitivity then openXML does not work. Also there is no workaround DLLs other than interop DLLs."},{"Id":"4603117045","Type":"IssuesEvent","CreatedAt":"2025-11-11T14:12:14","Actor":"mkaszewiak","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"labeled","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1970","RelatedDescription":null,"RelatedBody":"I'm using version 3.3\n\nWith .NET 10, when opening an document already formed with PNG images (2 or 3) and close it, some images have zero size in media folder after disposing. The first one is generally untouched, but the other ones are all empty.\n\nThe same document in .NET 9 behave correctly (images are not empty).\n\n\n"},{"Id":"4603111491","Type":"IssuesEvent","CreatedAt":"2025-11-11T14:11:59","Actor":"mkaszewiak","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"assigned","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1970","RelatedDescription":null,"RelatedBody":"I'm using version 3.3\n\nWith .NET 10, when opening an document already formed with PNG images (2 or 3) and close it, some images have zero size in media folder after disposing. The first one is generally untouched, but the other ones are all empty.\n\nThe same document in .NET 9 behave correctly (images are not empty).\n\n\n"},{"Id":"4603050956","Type":"IssuesEvent","CreatedAt":"2025-11-11T14:09:15","Actor":"mkaszewiak","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"assigned","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1971","RelatedDescription":null,"RelatedBody":"I am trying to open this file [testFile.docx](https://docs.google.com/document/d/1VVVcLk07EujdzBI9jTHSdYv5pP6mBOyw/edit?usp=drive_link&ouid=109338977916725867907&rtpof=true&sd=true)\n\nusing the code\n\n```c#\n static void Main(string[] args)\n {\n     try\n     {\n         using (WordprocessingDocument doc = WordprocessingDocument.Open(\"testFile.docx\", false))\n         {\n             Console.WriteLine(\"File is opened!\");\n         }\n     }\n     catch (Exception ex)\n     {\n         Console.WriteLine(\"General Exception caught:\");\n         Console.WriteLine($\"Type: {ex.GetType()}\");\n         Console.WriteLine($\"Message: {ex.Message}\");\n         Console.WriteLine($\"StackTrace: {ex.StackTrace}\");\n     }\n }\n```\n\nBut I am getting this message which isn't helpful\n\n> General Exception caught:\n> Type: System.InvalidOperationException\n> Message: Specified part does not exist in the package.\n> StackTrace:    at System.IO.Packaging.Package.GetPart(Uri partUri)\n>    at DocumentFormat.OpenXml.Features.PackageFeatureBase.DocumentFormat.OpenXml.Packaging.IPackage.GetPart(Uri uriTarget)\n>    at DocumentFormat.OpenXml.Packaging.PackageUriHandlingExtensions.MalformedUriHandlingPackage.GetPart(Uri uriTarget)\n>    at DocumentFormat.OpenXml.Packaging.OpenXmlPart.Load(OpenXmlPackage openXmlPackage, OpenXmlPart parent, Uri uriTarget, String id)\n>    at DocumentFormat.OpenXml.Packaging.PartRelationshipsFeature.LoadReferencedPartsAndRelationships()\n>    at DocumentFormat.OpenXml.Packaging.PartRelationshipsFeature.DocumentFormat.OpenXml.Features.IReferenceRelationshipsFeature.get_Relationships()\n>    at DocumentFormat.OpenXml.Packaging.OpenXmlPartContainer.get_ExternalRelationships()\n>    at Demo.Program.Main(String[] args) in ...\n\nIs there a way to find which part is missing?"},{"Id":"4570653379","Type":"IssuesEvent","CreatedAt":"2025-11-10T09:48:49","Actor":"mkaszewiak","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1966","RelatedDescription":"Closed issue \"how to copy  <w:drawing> <wp:inline  to other docx？\" (#1966) at dotnet/Open-XML-SDK","RelatedBody":"Can someone provide an example?\n\nthanks\n\nThe current approach is to save the original document as a new file, delete all the body content, place the relevant XML into the paragraph, and generate a new document. However, there is some error.\n```csharp\nopenXmlElement2 is DocumentFormat.OpenXml.Wordprocessing.Run\n<w:r> <w:drawing> <wp:inline>\n\nDocumentFormat.OpenXml.Wordprocessing.Paragraph paragraph6 = new DocumentFormat.OpenXml.Wordprocessing.Paragraph();\nforeach (OpenXmlElement element in openXmlElement1.Elements<DocumentFormat.OpenXml.Wordprocessing.ParagraphProperties>())\n{\n    OpenXmlElement newChild6 = element.CloneNode(true);\n    newChild6.RemoveAllChildren<SectionProperties>();\n    newChild6.RemoveAllChildren<ParagraphBorders>();\n    paragraph6.AppendChild<OpenXmlElement>(newChild6);\n}\nparagraph6.AppendChild<OpenXmlElement>(openXmlElement2.CloneNode(true));\ntableXmlElementList.Add(openXmlElement2);\ntablebody2.AppendChild<OpenXmlElement>(paragraph6.CloneNode(true));\n\nusing (WordprocessingDocument wordprocessingDocument2 = WordprocessingDocument.Open(temp1, true))\n{\n    Body body1 = wordprocessingDocument2.MainDocumentPart.Document.Body;\n\n    OpenXmlElement newChild11 = body1.Elements<SectionProperties>().FirstOrDefault<SectionProperties>().CloneNode(true);\n    newChild11.RemoveAllChildren<FooterReference>();\n    newChild11.RemoveAllChildren<HeaderReference>();\n    IEnumerable<PageMargin> source = newChild11.Descendants<PageMargin>();\n    if (source.Count<PageMargin>() > 0)\n        source.FirstOrDefault<PageMargin>().Bottom = (Int32Value)1710;\n    else\n        newChild11.Append((OpenXmlElement)new PageMargin()\n        {\n            Bottom = (Int32Value)1710\n        });\n    mathbody.AppendChild<OpenXmlElement>(newChild11);\n    wordprocessingDocument2.MainDocumentPart.Document.RemoveAllChildren<Body>();\n    wordprocessingDocument2.MainDocumentPart.Document.RemoveAllChildren<DocumentBackground>();\n    wordprocessingDocument2.MainDocumentPart.Document.Append((OpenXmlElement)mathbody);\n    wordprocessingDocument2.Save();\n}\n```\n=========================================\n```xml\n-<w:drawing>\n\n\n-<wp:inline wp14:editId=\"7BB75690\" wp14:anchorId=\"3EDB3CC6\" distR=\"0\" distL=\"0\" distB=\"0\" distT=\"0\">\n\n<wp:extent cx=\"3960000\" cy=\"2412000\"/>\n\n<wp:effectExtent r=\"2540\" b=\"7620\" t=\"0\" l=\"0\"/>\n\n\n-<wp:docPr name=\"图表 1\" id=\"6\">\n\n\n-<a:extLst xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">\n\n\n-<a:ext uri=\"{FF2B5EF4-FFF2-40B4-BE49-F238E27FC236}\">\n\n<a16:creationId id=\"{05A109B0-8715-5C68-1F51-FAAAA0F641B6}\" xmlns:a16=\"http://schemas.microsoft.com/office/drawing/2014/main\"/>\n\n</a:ext>\n\n</a:extLst>\n\n</wp:docPr>\n\n<wp:cNvGraphicFramePr/>\n\n\n-<a:graphic xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">\n\n\n-<a:graphicData uri=\"http://schemas.openxmlformats.org/drawingml/2006/chart\">\n\n<c:chart xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" r:id=\"rId4\" xmlns:c=\"http://schemas.openxmlformats.org/drawingml/2006/chart\"/>\n\n</a:graphicData>\n\n</a:graphic>\n\n</wp:inline>\n\n</w:drawing>\n```"},{"Id":"4559147447","Type":"IssuesEvent","CreatedAt":"2025-11-09T14:17:14","Actor":"koviroli","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1972","RelatedDescription":"Opened issue \"SpreadsheetDocument.Save() throws OpenXmlPackageException when saving .xlsb file due to unexpected styles.bin content type\" (#1972) at dotnet/Open-XML-SDK","RelatedBody":"\n### Describe the bug\n\nSaving an `.xlsb` opened via `SpreadsheetDocument` throws an `OpenXmlPackageException` about an unexpected content type for `/xl/styles.bin`. This occurs even if no modifications are made; simply opening and calling `Save()` triggers the error for `.xlsb`. The same code path works for `.xlsx` and `.xlsm`.\n\n### Exception\n\n```\nDocumentFormat.OpenXml.Packaging.OpenXmlPackageException: 'The document cannot be opened because there is an invalid part with an unexpected content type. \n[Part Uri=/xl/styles.bin], \n[Content Type=application/vnd.ms-excel.styles], \n[Expected Content Type=application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml].'\n```\n\n\nA temporary workaround is to force-get all public properties of the SpreadsheetDocument instance before saving; after doing so, Save() succeeds.\n\n### Screenshots\n\nN/A\n\n### To Reproduce\n\nA self-contained, minimal repro (console app):\n\n```\nusing DocumentFormat.OpenXml.Packaging;\n\nvar filePath = @\"PathToXlsb\\Book1.xlsb\";\nvar fileBytes = File.ReadAllBytes(filePath);\n\nvar stream = new MemoryStream();\nstream.Write(fileBytes, 0, fileBytes.Length);\nstream.Position = 0;\n\nusing var spreadsheetDocument = SpreadsheetDocument.Open(stream, true);\n\n// works with this solution\n//foreach (var prop in spreadsheetDocument.GetType().GetProperties())\n//{\n//    try\n//    {\n//        _ = prop.GetValue(spreadsheetDocument);\n//    }\n//    catch { }\n//}\n\n// Throws exception\nspreadsheetDocument.Save();\n```\n\n\n### Steps\n\n1. Open any `.xlsb` file with `SpreadsheetDocument.Open(stream, true)`.\n2. Immediately call `spreadsheetDocument.Save()`.\n3. Observe the `OpenXmlPackageException`.\n\n### Observed behavior\n\nAccessing all public properties on `SpreadsheetDocument` prior to saving (reflection-based getter loop) makes the save succeed.\n\n### Expected behavior\n\nOpening a valid `.xlsb` file, optionally modifying custom properties, and calling `Save()` should succeed without requiring any reflection-based workarounds.\n\n### Desktop (please complete the following information)\n\n- OS: Windows 11 Home (26100.2033)\n- Office version: N/A (repro does not require Office; opening/saving via SDK)\n- .NET Target: .NET 8 and .NET 10 (both reproduce)\n- DocumentFormat.OpenXml Version(s) tested: 3.3.0, 3.2.0, 3.1.1, 3.0.2, 3.0.1\n\n### Additional context\n\n- Only happens with `.xlsb`. The same code works for `.xlsx` and `.xlsm`.\n- The behavior cannot be reproduced with `WordprocessingDocument` or `PresentationDocument` for their respective formats.\n- The workaround (calling getters for all public properties on `SpreadsheetDocument`) suggests a lazy-loading/initialization or part registration issue specific to `.xlsb` styles content types."}],"ResultType":"GitHubEvent"}},"RunOn":"2025-11-16T03:30:22.7655013Z","RunDurationInMilliseconds":704}