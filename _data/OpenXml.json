{"Data":{"Sdk":{"Events":[{"Id":"46046752935","Type":"PullRequestEvent","CreatedAt":"2025-01-29T22:24:49","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1774","RelatedDescription":"Closed pull request \"Add open xml editor extension for Visual Studio Project\" (#1774) at dotnet/Open-XML-SDK","RelatedBody":"This moves the archived repo for the Open Xml Editor extension for Visual Studio from [Open-XML-Package-Editor-Power-Tool-for-Visual-Studio](https://github.com/OfficeDev/Open-XML-Package-Editor-Power-Tool-for-Visual-Studio) to the Open-XML-SDK repo."},{"Id":"46042775758","Type":"PullRequestEvent","CreatedAt":"2025-01-29T20:01:12","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1866","RelatedDescription":"Opened pull request \"add mp4 to MediaDataPartType enum\" (#1866) at dotnet/Open-XML-SDK","RelatedBody":""},{"Id":"45966461833","Type":"IssuesEvent","CreatedAt":"2025-01-27T22:35:49","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1665","RelatedDescription":"Closed issue \"Excel in-cell dropdown\" (#1665) at dotnet/Open-XML-SDK","RelatedBody":"I have this code below. The purpose of this code is to set very specific cell's to have drop down values. Not all cells in the column must have this dropdown and the data types differ for each cell.\r\n\r\nThis works fine and excel is created.\r\n\r\nThe issue here is that in Excel, for each cell that have a dropdown applied you need to:\r\n1. Select the cell\r\n2. Select the \"Data\" tab\r\n3. Select \"Data Validation\"\r\n4. Check the \"in-cell dropdown\" checkbox\r\nbefore the cell have a drop  down option\r\n\r\nThis code was developed using several sources to try and resolve the issue, and all of the sources advise more or less the same code\r\n\r\n```csharp\r\nif (data.ApplyLookup(x, rowIndex))\r\n{\r\n\tstring columnName = GetExcelColumnName(x + 1);\r\n\t\r\n\tDataValidation dataValidation = new DataValidation\r\n\t{\r\n\t\tType = DataValidationValues.List,\r\n\t\tShowDropDown = true,\r\n\t\tAllowBlank = true,\r\n\t\tSequenceOfReferences = new ListValue<StringValue> { InnerText = $\"{columnName}{rowIndex}\" }\r\n\t};\r\n\t\r\n\tstring lookupString = $\"\\\"{string.Join(\",\", data.LookupValues[x].Select(kv => kv.Value))}\\\"\";\r\n\tdataValidation.Formula1 = new Formula1(lookupString);\r\n\t\r\n\tdataValidations.Append(dataValidation);\r\n}\r\n```\r\n"},{"Id":"45965965785","Type":"IssuesEvent","CreatedAt":"2025-01-27T22:16:09","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/801","RelatedDescription":"Closed issue \"code of docs about create pptx result without any content\" (#801) at dotnet/Open-XML-SDK","RelatedBody":"- [ √ ] Question on library usage\r\n\r\nhttps://docs.microsoft.com/en-us/office/open-xml/how-to-create-a-presentation-document-by-providing-a-file-name\r\n\r\nsample code same to docs\r\n[ConsoleApp.zip](https://github.com/OfficeDev/Open-XML-SDK/files/5180913/ConsoleApp.zip)\r\n\r\nresult:\r\n![result](https://user-images.githubusercontent.com/16309962/92345502-21efa600-f0fc-11ea-9ff4-fb7c98f3cbd4.jpg)\r\n"},{"Id":"45965822197","Type":"IssuesEvent","CreatedAt":"2025-01-27T22:10:25","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1685","RelatedDescription":"Closed issue \"Excel with Comments is not working with Open XML SDK\" (#1685) at dotnet/Open-XML-SDK","RelatedBody":"0\r\n\r\nWe are trying to export excel with comments using Open Xml. I have tried with below code snippet and its showing comments in the Sheet Object but when exported to excel the comments are not displaying in the cells after opening excel.\r\n\r\n```csharp\r\n#public byte[] ExportJsonDatatoExcelWithComments()\r\n{\r\n\r\n    MemoryStream memoryStream = new MemoryStream();\r\n    SpreadsheetDocument spreadsheet = SpreadsheetDocument.Create(memoryStream, DocumentFormat.OpenXml.SpreadsheetDocumentType.Workbook);\r\n    WorkbookPart workbookPart = spreadsheet.AddWorkbookPart();\r\n\r\n    workbookPart.Workbook = new Workbook();\r\n    Sheets sheets = workbookPart.Workbook.AppendChild<Sheets>(new Sheets());\r\n    //OpenSheet\r\n    WorksheetPart worksheetPart = workbookPart.AddNewPart<WorksheetPart>();\r\n    SheetData sheetData = new SheetData();\r\n    worksheetPart.Worksheet = new Worksheet(sheetData);\r\n\r\n    var sheet = new Sheet() { Id = workbookPart.GetIdOfPart(worksheetPart), SheetId = 1, Name = \"test\" };\r\n    sheets.Append(sheet);\r\n    \r\n    WorksheetCommentsPart worksheetCommentsPart1 = worksheetPart.AddNewPart<WorksheetCommentsPart>();\r\n    GenerateWorksheetCommentsPart1Content(worksheetCommentsPart1);\r\n\r\n    OpenXmlWriter DataWriter = OpenXmlWriter.Create(worksheetPart);\r\n    DataWriter.WriteStartElement(sheetData);\r\n    DataWriter.WriteStartElement(worksheetPart.Worksheet);\r\n    \r\n    //closedata\r\n    DataWriter.WriteEndElement();\r\n    DataWriter.Close();\r\n    //\r\n    //render\r\n    // worksheetPart = null;\r\n    workbookPart.Workbook.Save();\r\n    spreadsheet.Save();\r\n    spreadsheet.Close();\r\n    memoryStream.Position = 0;\r\n    return memoryStream.ToArray();\r\n}\r\n\r\npublic void GenerateWorksheetCommentsPart1Content(WorksheetCommentsPart worksheetCommentsPart)\r\n{\r\n    Comments comments1 = new Comments() { MCAttributes = new MarkupCompatibilityAttributes() { Ignorable = \"xr\" } };\r\n\r\n\r\n    Authors authors1 = new Authors();\r\n    Author author1 = new Author();\r\n    author1.Text = \"User1\";\r\n\r\n    authors1.Append(author1);\r\n\r\n    CommentList commentList1 = new CommentList();\r\n\r\n    Comment comment1 = new Comment() { Reference = \"A3\", AuthorId = (UInt32Value)12, ShapeId = (UInt32Value)10, Guid = Guid.NewGuid().ToString() };\r\n    comment1.SetAttribute(new OpenXmlAttribute(\"xr\", \"uid\", \"http://schemas.microsoft.com/office/spreadsheetml/2014/revision\", \"{811649EF-4CB5-4311-BE14-228133003BE4}\"));\r\n\r\n    CommentText commentText1 = new CommentText();\r\n\r\n    Run run1 = new Run();\r\n\r\n    RunProperties runProperties1 = new RunProperties();\r\n    FontSize fontSize3 = new FontSize() { Val = 9D };\r\n    Color color3 = new Color() { Indexed = (UInt32Value)81U };\r\n    RunFont runFont1 = new RunFont() { Val = \"Tahoma\" };\r\n    RunPropertyCharSet runPropertyCharSet1 = new RunPropertyCharSet() { Val = 1 };\r\n\r\n    runProperties1.Append(fontSize3);\r\n    runProperties1.Append(color3);\r\n    runProperties1.Append(runFont1);\r\n    runProperties1.Append(runPropertyCharSet1);\r\n    Text text1 = new Text() { Space = SpaceProcessingModeValues.Preserve };\r\n    text1.Text = \"This is my comment!\\nThis is line 2!\\n\";\r\n\r\n    run1.Append(runProperties1);\r\n    run1.Append(text1);\r\n\r\n    commentText1.Append(run1);\r\n\r\n    comment1.Append(commentText1);\r\n\r\n    commentList1.Append(comment1);\r\n\r\n    comments1.Append(authors1);\r\n    comments1.Append(commentList1);\r\n   \r\n    worksheetCommentsPart.Comments = comments1;\r\n}\r\n```\r\nPlease let me know what is the issue with the code and how can we show comments for particular cell."},{"Id":"45965754053","Type":"IssuesEvent","CreatedAt":"2025-01-27T22:07:44","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1778","RelatedDescription":"Closed issue \"EndnotesPart.AddHyperlinkRelationship not generating proper endnotes.xml.rels\" (#1778) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\r\nAdding an endnote having hyperlink into a document having no existing relationship for an endnote part is not generating proper endnotes.xml.rels file due to which generated document cannot be open using MS word or any other related application.\r\n\r\n**Screenshots**\r\n\r\n![image](https://github.com/user-attachments/assets/85f3883b-5265-4086-8cd2-9616e67a58b6)\r\n![image](https://github.com/user-attachments/assets/10e50b3e-27fc-49a4-83f2-470d9e0b1261)\r\n\r\n\r\n**To Reproduce**\r\nKindly run attached console app to reproduce the issue.\r\n[EndnotesWithURLIssue.zip](https://github.com/user-attachments/files/16747036/EndnotesWithURLIssue.zip)\r\n\r\n**Observed behavior**\r\nIf same code is executed (EndnotesPart.AddHyperlinkRelationship) for document already having an existing relationship present for endnotepart then generated document can be opened.\r\n\r\n**Expected behavior**\r\nEndnotesPart.AddHyperlinkRelationship should create a proper endnotes.xml.rels if not present.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: windows 10\r\n - Office version: 16.0.17628.20188\r\n - .NET Target: 4.8\r\n - DocumentFormat.OpenXml Version: 2.5.0, 3.1.0\r\n\r\n**Debug Info**\r\nAdding below code before adding hyperlink relationship fixes the issue.\r\n\r\n```\r\nif(!document.Package.PartExists(new Uri(\"/word/_rels/endnotes.xml.rels\", UriKind.Relative)))\r\n{\r\n    var part = document.Package.CreatePart(new Uri(\"/word/_rels/endnotes.xml.rels\", UriKind.Relative), \"application/vnd.openxmlformats-package.relationships+xml\");\r\n    part.Package.Flush();\r\n}\r\n\r\n```\r\n"},{"Id":"45965648406","Type":"IssuesEvent","CreatedAt":"2025-01-27T22:03:37","Actor":"mikeebowen","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1864","RelatedDescription":"Closed issue \"Word file is corrupted after replacing the header in a word document which has section breaks using Open XML SDK\" (#1864) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\nHi, I am using the replace the header in a word processing document code which uses two documents. The header in fromFile.docx to be replaced in toFile.docx. The file toFile.docx already have section breaks. The section breaks can be added using Layout tab in word, select Breaks --> Section Breaks--> Next Page and save the document. After the header replacement code execution the toFile.docx became corrupted. Facing this issue and how this can be fixed. The code is given below.\n\n```csharp\nusing DocumentFormat.OpenXml.Packaging;\nusing DocumentFormat.OpenXml.Spreadsheet;\nusing DocumentFormat.OpenXml.Wordprocessing;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nstring fromFile = @\"C:\\Users\\jhe\\Desktop\\LearnAndTech\\HeaderAndFooter\\MSDNTest\\fromFile.docx\";\nstring toFile = @\"C:\\Users\\jhe\\Desktop\\LearnAndTech\\HeaderAndFooter\\MSDNTest\\toFile.docx\";\n\nAddHeaderFromTo(fromFile, toFile);\n\n\nstatic void AddHeaderFromTo(string fromFile, string toFile)\n{\n    // Replace header in target document with header of source document.\n    using (WordprocessingDocument wdDoc = WordprocessingDocument.Open(toFile, true))\n    using (WordprocessingDocument wdDocSource = WordprocessingDocument.Open(fromFile, true))\n    {\n        if (wdDocSource.MainDocumentPart is null || wdDocSource.MainDocumentPart.HeaderParts is null)\n        {\n            throw new ArgumentNullException(\"MainDocumentPart and/or HeaderParts is null.\");\n        }\n\n        if (wdDoc.MainDocumentPart is null)\n        {\n            throw new ArgumentNullException(\"MainDocumentPart is null.\");\n        }\n\n        MainDocumentPart mainPart = wdDoc.MainDocumentPart;\n\n        // Delete the existing header part.\n        mainPart.DeleteParts(mainPart.HeaderParts);\n\n        // Create a new header part.\n        DocumentFormat.OpenXml.Packaging.HeaderPart headerPart = mainPart.AddNewPart<HeaderPart>();\n\n        // Get Id of the headerPart.\n        string rId = mainPart.GetIdOfPart(headerPart);\n\n        // Feed target headerPart with source headerPart.\n\n        DocumentFormat.OpenXml.Packaging.HeaderPart? firstHeader = wdDocSource.MainDocumentPart.HeaderParts.FirstOrDefault();\n\n        wdDocSource.MainDocumentPart.HeaderParts.FirstOrDefault();\n\n        if (firstHeader is not null)\n        {\n            headerPart.FeedData(firstHeader.GetStream());\n        }\n\n        if (mainPart.Document.Body is null)\n        {\n            throw new ArgumentNullException(\"Body is null.\");\n        }\n\n        // Get SectionProperties and Replace HeaderReference with new Id.\n        IEnumerable<DocumentFormat.OpenXml.Wordprocessing.SectionProperties> sectPrs = mainPart.Document.Body.Elements<SectionProperties>();\n        foreach (var sectPr in sectPrs)\n        {\n            // Delete existing references to headers.\n            sectPr.RemoveAllChildren<HeaderReference>();\n\n            // Create the new header reference node.\n            sectPr.PrependChild<HeaderReference>(new HeaderReference() { Id = rId });\n        }\n    }\n}\n```\n\n**To Reproduce**\nCreate fromFile.docx and toFile.docx files with headers.\nAdd section breaks to toFile.docx. The section breaks can be added using Layout tab in word, select Breaks --> Section Breaks--> Next Page and save the document. Execute the above code. \n\n\n**Observed behavior**\nA popup will be shown while opening the toFile.docx after the above code execution which says 'word found unreadable contents in toFile.docx. Do you want to recover the contents of this document? '.\n\n**Expected behavior**\nOpen the file without corruption or any error,\n\n**Desktop (please complete the following information):**\n - OS: Windows 10\n - Office version : Microsoft 365 Apps for enterprise Version 2412\n - .NET Target: any\n - DocumentFormat.OpenXml Version: 3.2.0\n\nThanks in advance."},{"Id":"45955412972","Type":"IssuesEvent","CreatedAt":"2025-01-27T16:36:54","Actor":"AlfredHellstern","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1851","RelatedDescription":"Closed issue \"On desktop Word file is corrupted, but I can open it online or with Libre Office or WPS...\" (#1851) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\nHello, I create generation of word file from dotx template. But in desktop Word Office app I can't open file, but with another ways, I can open (WPS, Libre Office, Google Docs, Online Office)\nWhat the problem? Is this because I clone dotx file and generate docx?\n\n```csharp\npublic ActionResult GenerateDocument(int reportViewId, int rid)\n{\n\n    string templatePath = Server.MapPath(\"~/Content/templates/word/Template.dotx\");\n    if (RepView.WordTemplateFileName != null)\n    {\n        templatePath = Server.MapPath(\"\\\\UserFiles\\\\ReportViewWordTemplates\\\\\" + RepView.WordTemplateFileId);\n    }\n    string outputPath = Server.MapPath(\"~/generated.docx\");\n\n    using (MemoryStream memoryStream = new MemoryStream())\n    {\n        try\n        {\n            using (WordprocessingDocument wordDoc = WordprocessingDocument.Open(templatePath, false))\n            {\n                wordDoc.Clone(memoryStream);\n            }\n\n        }\n        catch\n        {\n            using (WordprocessingDocument wordDoc = WordprocessingDocument.Open(templatePath, false))\n            {\n                wordDoc.Clone(memoryStream);\n            }\n        }\n\n        using (WordprocessingDocument generatedDoc = WordprocessingDocument.Open(memoryStream, true))\n        {\n            memoryStream.Position = 0;\n            var mainDocumentPart = generatedDoc.MainDocumentPart;\n\n            var body = mainDocumentPart.Document.Body;\n\n            var headerParts = generatedDoc.MainDocumentPart.HeaderParts;\n            var footerParts = generatedDoc.MainDocumentPart.FooterParts;\n\n            foreach (var parts in headerParts)\n            {\n                foreach (var currentText in parts.RootElement.Descendants<DocumentFormat.OpenXml.Wordprocessing.Text>())\n                {\n                    currentText.Text = currentText.Text.Replace(\"Header\", header);\n                }\n            }\n            foreach (var parts in footerParts)\n            {\n                foreach (var currentText in parts.RootElement.Descendants<DocumentFormat.OpenXml.Wordprocessing.Text>())\n                {\n                    currentText.Text = currentText.Text.Replace(\"Bottom\", bottom);\n                }\n            }\n\n            ImagePart imgp = mainDocumentPart.AddImagePart(ImagePartType.Png);\n            var textElements = body.Descendants<Text>()\n          .Where(t => t.Text.Contains(\"text\"))\n          .FirstOrDefault();\n   \n            var run = new Run(new Text());\n            if (textElements != null)\n            {\n                run = textElements.Parent as Run;\n            }\n           \n            foreach (var item in headers)\n            {\n                if (blocks.Where(p => p.DocumentConstructorHeaderId == item.DocumentConstructorHeaderId).Count() != 0)\n                {\n                    \n                    if (item.SizeTitle > 1)\n                    {\n                        AddHeading(body, item.Title, 1, mainDocumentPart.StyleDefinitionsPart);\n                    }\n                    else\n                    {\n                        AddHeading(body, item.Title, 2, mainDocumentPart.StyleDefinitionsPart);\n                    }\n                }\n\n                foreach (var list in newBlocks.Where(p => p.DocumentConstructorHeaderId == item.DocumentConstructorHeaderId).OrderBy(p => p.Npp).ToList())\n                {\n                    if (list.ImageData != null)\n                    {\n                        using (var imageStream = new MemoryStream(list.ImageData))\n                        {\n                            imgp.FeedData(imageStream);\n                        }\n\n                        AddImageToBody(mainDocumentPart, list.ImageData);\n                    }\n                    /*if (list.Content != null)\n                    {\n                        AddHeading(body, item.Title, 1, mainDocumentPart.StyleDefinitionsPart);\n                    }*/\n\n                    Paragraph para = body.AppendChild(new Paragraph());\n\n                    if (textElements != null)\n                    {\n                        // Извлекаем свойства Run\n                        var runProperties = run.RunProperties?.CloneNode(true);\n                        var newRun = new Run(new Text(list.Content));\n                        newRun.PrependChild(runProperties);\n                        para.AppendChild(newRun);\n                    }\n                    else\n                    {\n                        para.AppendChild(new Run(new Text(list.Content)));\n                    }\n                    ReplaceText(body, \"text\", \"\");\n                }\n            }\n            generatedDoc.Close();\n        }\n        return File(memoryStream.ToArray(), \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\", \"generated.docx\");\n    }\n}\n```\n\n"},{"Id":"45955146127","Type":"IssuesEvent","CreatedAt":"2025-01-27T16:30:00","Actor":"AlfredHellstern","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1787","RelatedDescription":"Closed issue \"Cloning sheet doesn't clone Drawing part\" (#1787) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\nI have a template xlsx file, with template sheet, which in turn are cloned and their content is replaced ie. Cell values and images. \nAfter opening the file, the cell values are unique for each cloned Sheet except for the images which are the same, namely the last replaced image.\n\n**Screenshots**\n<img width=\"194\" alt=\"image\" src=\"https://github.com/user-attachments/assets/ed70d85a-1577-4e2b-97d5-975815d3923a\">\n\n**To Reproduce**\nI have this code which clones a given Sheet:\n```csharp\n    public static async void CloneSheet(SpreadsheetDocument spreadSheet, string sheetName, string newSheetName) {\n          // Get the source sheet\n          var sheets = spreadSheet.WorkbookPart.Workbook.Sheets;\n          var sourceSheet = sheets.Elements<Sheet>().FirstOrDefault(s => s.Name == sheetName);\n          if (sourceSheet == null) {\n              throw new ArgumentException($\"Sheet with name {sheetName} does not exist.\");\n          }\n\n          // Get the source worksheet part\n          var sourceSheetPart = (WorksheetPart)spreadSheet.WorkbookPart.GetPartById(sourceSheet.Id);\n\n          // Create a new worksheet part\n          var newSheetPart = spreadSheet.WorkbookPart.AddNewPart<WorksheetPart>();\n          newSheetPart.Worksheet = (Worksheet)sourceSheetPart.Worksheet.Clone();\n\n          // Clone the relationships\n          foreach (var rel in sourceSheetPart.Parts) {\n              newSheetPart.AddPart(rel.OpenXmlPart, rel.RelationshipId);\n          }\n\n          // Clone DrawingsPart and its related ImageParts\n          if (sourceSheetPart.DrawingsPart != null) {\n              var sourceDrawingsPart = sourceSheetPart.DrawingsPart;\n              DrawingsPart newDrawingsPart;\n              \n              if (newSheetPart.DrawingsPart == null) {\n                  newDrawingsPart = newSheetPart.AddNewPart<DrawingsPart>();\n              } else {\n                  newDrawingsPart = newSheetPart.DrawingsPart;\n              }\n\n              newDrawingsPart.WorksheetDrawing = (WorksheetDrawing)sourceDrawingsPart.WorksheetDrawing.Clone();\n\n              var imagePartsToClone = sourceDrawingsPart.ImageParts.ToList();\n\n              foreach (var imagePart in imagePartsToClone) {\n                  var newImagePart = newDrawingsPart.AddImagePart(imagePart.ContentType);\n\n\n                  using (var stream = imagePart.GetStream()) {\n                          newImagePart.FeedData(stream);\n                  }\n\n                  // Update the BlipFill.Blip.Embed.Value to reference the new image part\n                  foreach (var blip in newDrawingsPart.WorksheetDrawing.Descendants<DocumentFormat.OpenXml.Drawing.Blip>()) {\n                      if (blip.Embed.Value == sourceDrawingsPart.GetIdOfPart(imagePart)) {\n                          var newId = newDrawingsPart.GetIdOfPart(newImagePart);\n                          blip.Embed.Value = newId;\n                      }\n                  }\n              }\n          }\n\n          // Create a new sheet and add it to the workbook\n          var newSheetId = spreadSheet.WorkbookPart.GetIdOfPart(newSheetPart);\n          var newSheet = new Sheet {\n              Id = newSheetId,\n              SheetId = sheets.Elements<Sheet>().Max(s => s.SheetId.Value) + 1,\n              Name = newSheetName // todo: Ensure the new sheet name is unique\n          };\n\n          sheets.Append(newSheet);\n\n          // Save the workbook\n          spreadSheet.WorkbookPart.Workbook.Save();\n      }\n```\n\n**Observed behavior**\nWhat I discovered is that the `Clone()` method on the `sourceDrawingsPart.WorksheetDrawing` doesn't work and in effect, make all the cloned sheets share the DrawingsPart.\n\n**Expected behavior**\nHow can achieve DrawingsPart cloning to work?\n\n**Desktop (please complete the following information):**\n - OS: MacOS, Windows\n - .NET Target: .NET Core, .NET Framework\n - DocumentFormat.OpenXml Version: 3.1.0, 3.0.2\n"},{"Id":"45954867354","Type":"PullRequestEvent","CreatedAt":"2025-01-27T16:22:51","Actor":"AlfredHellstern","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"merged","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/pull/1862","RelatedDescription":"Merged pull request \"Bump dawidd6/action-download-artifact from 6 to 8\" (#1862) at dotnet/Open-XML-SDK","RelatedBody":"Bumps [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact) from 6 to 8.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/dawidd6/action-download-artifact/releases\">dawidd6/action-download-artifact's releases</a>.</em></p>\n<blockquote>\n<h2>v8</h2>\n<h2>New features</h2>\n<ul>\n<li><code>use_unzip</code> boolean input (defaulting to false) - if set to true, the action will use system provided <code>unzip</code> utility for unpacking downloaded artifact(s) (note that the action will first download the .zip artifact file, then unpack it and remove the .zip file)</li>\n</ul>\n<h2>What's Changed</h2>\n<ul>\n<li>README: v7 by <a href=\"https://github.com/haines\"><code>@​haines</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/318\">dawidd6/action-download-artifact#318</a></li>\n<li>Unzip by <a href=\"https://github.com/dawidd6\"><code>@​dawidd6</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/325\">dawidd6/action-download-artifact#325</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/haines\"><code>@​haines</code></a> made their first contribution in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/318\">dawidd6/action-download-artifact#318</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/dawidd6/action-download-artifact/compare/v7...v8\">https://github.com/dawidd6/action-download-artifact/compare/v7...v8</a></p>\n<h2>v7</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>build(deps): bump fast-xml-parser from 4.4.0 to 4.4.1 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/299\">dawidd6/action-download-artifact#299</a></li>\n<li>build(deps): bump <code>@​actions/artifact</code> from 2.1.7 to 2.1.9 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/300\">dawidd6/action-download-artifact#300</a></li>\n<li>build(deps): bump adm-zip from 0.5.14 to 0.5.15 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/301\">dawidd6/action-download-artifact#301</a></li>\n<li>build(deps): bump adm-zip from 0.5.15 to 0.5.16 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/306\">dawidd6/action-download-artifact#306</a></li>\n<li>build(deps): bump path-to-regexp from 6.2.2 to 6.3.0 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/307\">dawidd6/action-download-artifact#307</a></li>\n<li>build(deps): bump <code>@​actions/artifact</code> from 2.1.9 to 2.1.10 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/311\">dawidd6/action-download-artifact#311</a></li>\n<li>build(deps): bump <code>@​actions/core</code> from 1.10.1 to 1.11.0 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/310\">dawidd6/action-download-artifact#310</a></li>\n<li>build(deps): bump <code>@​actions/core</code> from 1.11.0 to 1.11.1 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/312\">dawidd6/action-download-artifact#312</a></li>\n<li>build(deps): bump <code>@​actions/artifact</code> from 2.1.10 to 2.1.11 by <a href=\"https://github.com/dependabot\"><code>@​dependabot</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/313\">dawidd6/action-download-artifact#313</a></li>\n<li>build(deps): Fix cross-spawn &gt;=7.0.0 &lt;= 7.0.5 vulnerability by <a href=\"https://github.com/alexcouret\"><code>@​alexcouret</code></a> in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/317\">dawidd6/action-download-artifact#317</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/alexcouret\"><code>@​alexcouret</code></a> made their first contribution in <a href=\"https://redirect.github.com/dawidd6/action-download-artifact/pull/317\">dawidd6/action-download-artifact#317</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/dawidd6/action-download-artifact/compare/v6...v7\">https://github.com/dawidd6/action-download-artifact/compare/v6...v7</a></p>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/20319c5641d495c8a52e688b7dc5fada6c3a9fbc\"><code>20319c5</code></a> README: v8</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/e58a9e5d14231715ece082f2068a0bd148cb72e6\"><code>e58a9e5</code></a> Unzip (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/325\">#325</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/6d05268723e4080b84fe8d5c0c5cd83226a81e5f\"><code>6d05268</code></a> node_modules: update</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/c03fb0c92813d0d9b088539572090518f7797df4\"><code>c03fb0c</code></a> README: v7 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/318\">#318</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/80620a5d27ce0ae443b965134db88467fc607b43\"><code>80620a5</code></a> node_modules: update</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/b15e003f466e47921c37351b59dce4f67d3f6693\"><code>b15e003</code></a> node_modules: install</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/1ee9a455fd340a42764af180c706e2f14a5c03ee\"><code>1ee9a45</code></a> build(deps): Fix cross-spawn &gt;=7.0.0 &lt;= 7.0.5 vulnerability (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/317\">#317</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/b2f2706ac43ccd303d565ec5c26f486548c111f4\"><code>b2f2706</code></a> build(deps): bump <code>@​actions/artifact</code> from 2.1.10 to 2.1.11 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/313\">#313</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/fdbeba027cd21fcbef155277d8e81c3e81e0bafe\"><code>fdbeba0</code></a> build(deps): bump <code>@​actions/core</code> from 1.11.0 to 1.11.1 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/312\">#312</a>)</li>\n<li><a href=\"https://github.com/dawidd6/action-download-artifact/commit/a74b42987a3ec3d6a405b3b18e968fb17f25847a\"><code>a74b429</code></a> build(deps): bump <code>@​actions/core</code> from 1.10.1 to 1.11.0 (<a href=\"https://redirect.github.com/dawidd6/action-download-artifact/issues/310\">#310</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/dawidd6/action-download-artifact/compare/v6...v8\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=dawidd6/action-download-artifact&package-manager=github_actions&previous-version=6&new-version=8)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>"},{"Id":"45922574393","Type":"IssuesEvent","CreatedAt":"2025-01-26T13:31:21","Actor":"JSydney04","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1864","RelatedDescription":"Opened issue \"Word file is corrupted when replace the header in a word document which has section breaks, using Open XML SDK for replacing header\" (#1864) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\nHi, I am using the replace the header in a word processing document code which uses two documents. The header in fromFile.docx to be replaced in toFile.docx. The file toFile.docx already have section breaks. The section breaks can be added using Layout tab in word, select Breaks --> Section Breaks--> Next Page and save the document. After the header replacement code execution the toFile.docx became corrupted. Facing this issue and how this can be fixed. The code is given below.\n\n\nusing DocumentFormat.OpenXml.Packaging;\nusing DocumentFormat.OpenXml.Spreadsheet;\nusing DocumentFormat.OpenXml.Wordprocessing;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\n\nstring fromFile = @\"C:\\Users\\jhe\\Desktop\\LearnAndTech\\HeaderAndFooter\\MSDNTest\\fromFile.docx\";\nstring toFile = @\"C:\\Users\\jhe\\Desktop\\LearnAndTech\\HeaderAndFooter\\MSDNTest\\toFile.docx\";\n\nAddHeaderFromTo(fromFile, toFile);\n\n\nstatic void AddHeaderFromTo(string fromFile, string toFile)\n{\n    // Replace header in target document with header of source document.\n    using (WordprocessingDocument wdDoc = WordprocessingDocument.Open(toFile, true))\n    using (WordprocessingDocument wdDocSource = WordprocessingDocument.Open(fromFile, true))\n    {\n        if (wdDocSource.MainDocumentPart is null || wdDocSource.MainDocumentPart.HeaderParts is null)\n        {\n            throw new ArgumentNullException(\"MainDocumentPart and/or HeaderParts is null.\");\n        }\n\n        if (wdDoc.MainDocumentPart is null)\n        {\n            throw new ArgumentNullException(\"MainDocumentPart is null.\");\n        }\n\n        MainDocumentPart mainPart = wdDoc.MainDocumentPart;\n\n        // Delete the existing header part.\n        mainPart.DeleteParts(mainPart.HeaderParts);\n\n        // Create a new header part.\n        DocumentFormat.OpenXml.Packaging.HeaderPart headerPart = mainPart.AddNewPart<HeaderPart>();\n\n        // Get Id of the headerPart.\n        string rId = mainPart.GetIdOfPart(headerPart);\n\n        // Feed target headerPart with source headerPart.\n\n        DocumentFormat.OpenXml.Packaging.HeaderPart? firstHeader = wdDocSource.MainDocumentPart.HeaderParts.FirstOrDefault();\n\n        wdDocSource.MainDocumentPart.HeaderParts.FirstOrDefault();\n\n        if (firstHeader is not null)\n        {\n            headerPart.FeedData(firstHeader.GetStream());\n        }\n\n        if (mainPart.Document.Body is null)\n        {\n            throw new ArgumentNullException(\"Body is null.\");\n        }\n\n        // Get SectionProperties and Replace HeaderReference with new Id.\n        IEnumerable<DocumentFormat.OpenXml.Wordprocessing.SectionProperties> sectPrs = mainPart.Document.Body.Elements<SectionProperties>();\n        foreach (var sectPr in sectPrs)\n        {\n            // Delete existing references to headers.\n            sectPr.RemoveAllChildren<HeaderReference>();\n\n            // Create the new header reference node.\n            sectPr.PrependChild<HeaderReference>(new HeaderReference() { Id = rId });\n        }\n    }\n}\n\n**To Reproduce**\nCreate fromFile.docx and toFile.docx files with headers.\nAdd section breaks to toFile.docx. The section breaks can be added using Layout tab in word, select Breaks --> Section Breaks--> Next Page and save the document. Execute the above code. \n\n\n**Observed behavior**\nA popup will be shown while opening the toFile.docx after the above code execution which says 'word found unreadable contents in toFile.docx. Do you want to recover the contents of this document? '.\n\n**Expected behavior**\nOpen the file without corruption or any error,\n\n**Desktop (please complete the following information):**\n - OS: Windows 10\n - Office version : Microsoft 365 Apps for enterprise Version 2412\n - .NET Target: any\n - DocumentFormat.OpenXml Version: 3.2.0\n\nThanks in advance."}],"ResultType":"GitHubEvent"}},"RunOn":"2025-02-01T03:30:23.132509Z","RunDurationInMilliseconds":597}