{"Data":{"Sdk":{"Events":[{"Id":"34570842660","Type":"IssuesEvent","CreatedAt":"2024-01-04T12:29:34","Actor":"ilayna","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1636","RelatedDescription":"Opened issue \"Bug with Open XML SDK v3.0 \" (#1636) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\r\nGetting the root element of a `WorkbookPart` of an excel with invalid hyperlinks causes the following exception:\r\n```\r\nSystem.ObjectDisposedException: Cannot access a closed stream.\r\nObject name: 'DeflateStream'.\r\n   at System.IO.Compression.DeflateStream.<EnsureNotDisposed>g__ThrowStreamClosedException|42_0()\r\n   at System.IO.Compression.DeflateStream.ReadCore(Span`1 buffer)\r\n   at System.IO.Compression.DeflateStream.Read(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.IO.Packaging.ZipWrappingStream.Read(Byte[] buffer, Int32 offset, Int32 count)\r\n   at System.Xml.XmlTextReaderImpl.InitStreamInput(Uri baseUri, String baseUriStr, Stream stream, Byte[] bytes, Int32 byteCount, Encoding encoding)\r\n   at System.Xml.XmlTextReaderImpl.FinishInitStream()\r\n   at System.Xml.XmlTextReaderImpl..ctor(Stream stream, Byte[] bytes, Int32 byteCount, XmlReaderSettings settings, Uri baseUri, String baseUriStr, XmlParserContext context, Boolean closeInput)\r\n   at System.Xml.XmlReaderSettings.CreateReader(Stream input, Uri baseUri, String baseUriString, XmlParserContext inputContext)\r\n   at System.Xml.XmlReader.Create(Stream input, XmlReaderSettings settings)\r\n   at DocumentFormat.OpenXml.XmlConvertingReaderFactory.Create(Stream partStream, IOpenXmlNamespaceResolver resolver, XmlReaderSettings settings, Boolean strictRelationshipFound)\r\n   at DocumentFormat.OpenXml.OpenXmlPartRootElement.LoadFromPart(OpenXmlPart openXmlPart, Stream partStream)\r\n   at DocumentFormat.OpenXml.Packaging.OpenXmlPart.LoadDomTree[T]()\r\n   at DocumentFormat.OpenXml.Packaging.WorkbookPart.get_Workbook()\r\n   at DocumentFormat.OpenXml.Packaging.WorkbookPart.get_PartRootElement()\r\n   at DocumentFormat.OpenXml.Packaging.OpenXmlPart.get_RootElement()\r\n``` \r\nOpening the .xlsx file with excel, selecting all columns and clicking `remove hyperlinks` solves the problem.\r\n\r\n**To Reproduce**\r\n```\r\nclass Program\r\n{\r\n    private static async Task Main(string[] args)\r\n    {\r\n        var excelParser = new ExcelParser(NullLogger<ExcelParser>.Instance);\r\n        var excels = Directory.GetFiles(@\"Excels\", \"*.xlsx\");\r\n        await using var stream = File.OpenRead(excels.FirstOrDefault()); // this is the excel (believe me ;))\r\n        await excelParser.ToolsFromExcelTask(stream);\r\n    }\r\n}\r\n\r\n\r\n  public ValueTask<ICollection<ToolModel>> ToolsFromExcelTask(Stream excelStream)\r\n    {\r\n        using var spreadSheetDocument = SpreadsheetDocument.Open(excelStream, false);\r\n        var workbookPart =  spreadSheetDocument.WorkbookPart;\r\n\r\n\r\n        /*\r\n         *  Bug lies somewhere in the following line, it throws an ObjectDisposedException\r\n         *  on some excels (not all)\r\n         */\r\n        var sheets = workbookPart.RootElement.GetFirstChild<Sheets>().Elements<Sheet>().ToList();\r\n      \r\n        var sharedStringTable = workbookPart.SharedStringTablePart?.SharedStringTable;\r\n        ........\r\n}\r\n```\r\n\r\nSteps to reproduce the behavior:\r\nMove the excel with the malformed hyperlinks to \"Excels\".\r\nRun the following code.\r\nSee error.\r\nNote: in practice, i tried it on many files, with some it worked others not so much...\r\nwith 3-4 files it seems to always happen with the same ones, when I tested with many many files I couldn't really point it to specific files.\r\n\r\n**Observed behavior**\r\nThrew an error.\r\n\r\n**Expected behavior**\r\nNot to.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOs 14.2.1\r\n - Office version 16.80\r\n - .NET Target: .NET Core 8 (tried with 6 also)\r\n - DocumentFormat.OpenXml Version: 3.0.0\r\n\r\n**Additional context**\r\nWhen I ran the same program with OpenXml 2.2 it threw UriMalformed (or something like that) and crashed at \r\n`using var spreadSheetDocument = SpreadsheetDocument.Open(excelStream, false);`\r\n\r\nOpening the .xlsx file with excel, selecting all columns and clicking `remove hyperlinks` solves the problem.\r\nthe hyperlinks are in the format of `som_e_thing_@LIK_th is` \r\nI can't attach the files I tested with, sorry.\r\n\r\nMight be related to Add better support for malformed URIs #1322"},{"Id":"34410397501","Type":"IssuesEvent","CreatedAt":"2023-12-26T10:33:56","Actor":"kunalchandratre1","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1635","RelatedDescription":"Opened issue \"Read sensitivity labelled documents\" (#1635) at dotnet/Open-XML-SDK","RelatedBody":"Add support for reading sensitivity labelled documents. As of today if document is labelled by sensitivity then openXML does not work. Also there is no workaround DLLs other than interop DLLs."},{"Id":"34408832187","Type":"IssuesEvent","CreatedAt":"2023-12-26T08:49:48","Actor":"yatintripathi","Repository":"dotnet/Open-XML-SDK","Organization":"dotnet","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/dotnet/Open-XML-SDK/issues/1634","RelatedDescription":"Opened issue \"Issue with OpenXml WmlComparer when comparing documents with different numbering styles, Bug with Open XML SDK\" (#1634) at dotnet/Open-XML-SDK","RelatedBody":"**Describe the bug**\r\nI'm currently using the OpenXml library in C# to compare two Word documents utilizing the WmlComparer.Compare method. The comparison works well in most cases, but I'm encountering an issue specifically related to legal style numbering.\r\n\r\nWhen comparing two documents, if one contains legal style numbering and the other doesn't, the resulting compared document loses the legal numbering entirely, without even maintaining a strikethrough format.\r\n\r\nI've already implemented the comparison using WmlComparer.Compare and set the necessary comparison settings. However, I'm struggling to retain the legal style numbering or apply strikethrough formatting to the mismatched numbering when generating the compared document.\r\n\r\nFor more Reference :- [](https://stackoverflow.com/questions/77697178/issue-with-openxml-wmlcomparer-when-comparing-documents-with-different-numbering?noredirect=1#comment136981416_77697178)\r\n\r\n**Screenshots**\r\n**These are how the documents look :-** \r\n![Screenshot (55)](https://github.com/dotnet/Open-XML-SDK/assets/108450640/66c5d736-3b39-4215-8064-1731a668946d)\r\n![Screenshot (57)](https://github.com/dotnet/Open-XML-SDK/assets/108450640/27d0211c-4dba-46a9-a51c-e4933e3e950a)\r\n\r\n**Microsoft Word's inherent working functionality :-**\r\n![Screenshot (58)](https://github.com/dotnet/Open-XML-SDK/assets/108450640/e2dad431-87c5-4cb9-8d5f-a1070462fef5)\r\n\r\n**OpenXML SDK WmlComparer working functionality :-**\r\n![Screenshot (60)](https://github.com/dotnet/Open-XML-SDK/assets/108450640/f117a26b-e587-4fbf-acc2-8f3fe138b825)\r\n\r\nYo will see differences between Microsoft Word's inherent working functionality and OpenXML SDK WmlComparer working functionality.\r\n\r\n****To Reproduce****\r\nCreate two docs in similar manner as in the screenshots of how the documents look and compare it via WmlComparer code you will be able to reproduce the Observed behavior and to reproduce the Expected behavior compare the two docs via compare functionality that word provides.\r\n \r\nSteps to [Right-of-First-Refusal-Agreement - 18th December, 2023 16.42.49.75 -7eeef2fbc8e54396acb1d950b7e.docx](https://github.com/dotnet/Open-XML-SDK/files/13770078/Right-of-First-Refusal-Agreement.-.18th.December.2023.16.42.49.75.-7eeef2fbc8e54396acb1d950b7e.docx) the behavior:\r\n1. Go to WORD.\r\n2. Click on Review Tab and click on compare and compare two word documents , one with Legal Numbering System and one without it and compare.\r\n3. You will see inherent working functionality of compare \r\n4. To generate Legal numbering in a word document\r\n5. Click on Multilevel list on the taskbar of word\r\n6. Click on  Define new multilevel list\r\n7. Click on more\r\n8. On the right hand side you will see a check box of Legal Numbering Style\r\n9. Check it and press OK.\r\n\r\n**Observed behavior**\r\nAs you can see from the screenshot above \"OpenXML SDK WmlComparer working functionality\" legal numbering is not retained.\r\n\r\n**Expected behavior**\r\nAs you can see from the screenshot above \"Microsoft Word's inherent working functionality\" legal numbering is retained.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Windows\r\n - Office version : Version 2311 (Build 17029.20108)\r\n - .NET Target:  .NET Core Version 7.0.102\r\n - DocumentFormat.OpenXml Version: 2.20.0\r\n - OpenXMLPowerTools Version : 4.5.3.2\r\n\r\n**These are the two sample documents using which you can repro the issue :-**\r\n[Right-of-First-Refusal-Agreement - 18th December, 2023 16.42.49.75 -7eeef2fbc8e54396acb1d950b7e.docx](https://github.com/dotnet/Open-XML-SDK/files/13770088/Right-of-First-Refusal-Agreement.-.18th.December.2023.16.42.49.75.-7eeef2fbc8e54396acb1d950b7e.docx)\r\n[Right-of-First-Refusal-Agreement - 18th December, 2023 16.40.39.42 -5c51a8aa25f3430ca6770c32b8f.docx](https://github.com/dotnet/Open-XML-SDK/files/13770090/Right-of-First-Refusal-Agreement.-.18th.December.2023.16.40.39.42.-5c51a8aa25f3430ca6770c32b8f.docx)\r\n\r\n**Below is the code :-**\r\n\r\n```\r\nWmlComparerSettings settings = new WmlComparerSettings\r\n            {\r\n                AuthorForRevisions = author,\r\n                DetailThreshold = 0\r\n            };\r\n            var originalDoc = new WmlDocument(originalPath.ToString());\r\n            var revisedDoc = new WmlDocument(revisedPath.ToString());\r\n\r\n            WmlDocument comparedDoc = WmlComparer.Compare(originalDoc, revisedDoc, settings);\r\n```\r\n\r\n@EricWhiteDev \r\n@ThomasBarnekow \r\n@twsouthwick "}],"ResultType":"GitHubEvent"}},"RunOn":"2024-01-08T03:30:21.1185777Z","RunDurationInMilliseconds":736}