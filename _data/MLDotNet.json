{"Data":{"GitHub":{"Issues":[{"Id":"665632649","IsPullRequest":false,"CreatedAt":"2020-07-25T18:24:44","Actor":"Aleksey1555","Number":"5324","RawContent":null,"Title":"Transform Vector<Byte> to Vector<width,height,3>","State":"open","Body":"### System information\r\n\r\n- **OS version/distro**: Windows 10 x64\r\n- **.NET Version (eg., dotnet --info)**: .Net Core 3.1\r\n\r\n### Issue\r\n\r\n- **What did you do?** Creating pipeline for image loading \r\n- **What happened?**  'Schema mismatch for input column 'Data': expected Vector<Byte, 45, 45, 3>, got Vector<Byte> \r\n- **What did you expect?** i don't , i want to known - how covert Vector's\r\n\r\n### Source code / logs\r\n\r\nHow to Convert Vectors?\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5324","RelatedDescription":"Open issue \"Transform Vector<Byte> to Vector<width,height,3>\" (#5324)"},{"Id":"661228371","IsPullRequest":false,"CreatedAt":"2020-07-24T01:11:53","Actor":"sereal96","Number":"5314","RawContent":null,"Title":"My confusion trying to use EAST text detector model with the ML.net","State":"closed","Body":"### System information\r\n\r\n- **OS version/distro:Windows 10**:\r\n\r\n### Issue\r\n\r\n- **What did you do?**\r\nHi, well I am trying to use a the EAST text detector model with the ML.net\r\nfrom here:\r\n\r\nhttps://www.kaggle.com/yelmurat/frozen-east-text-detection\r\n\r\nhowever I don't know if I am doing it the right way. (I only began using ML.net last month) First I tried using\r\nOpenCV with this example:\r\n\r\nhttps://github.com/opencv/opencv/blob/master/samples/dnn/text_detection.cpp\r\n\r\nIt runs fine everything is Ok, but when I tried to do the same with ML.net...\r\n\r\n- **What happened?**\r\nThe problem is that I dont understand how ML.net handle the input data, and the output data. I had an idea. I run other examples, but I couldn't find something similar.\r\n\r\n- **What did you expect?**\r\nI was expecting to have the same or at least similar results like those from OpenCV example.\r\n\r\n### Source code / logs\r\n\r\nFirst I define this\r\n\r\n`       static readonly string _assetsPath = Path.Combine(Environment.CurrentDirectory, \"assets\");\r\n        static readonly string _imagesFolder = Path.Combine(_assetsPath, \"imagesText\");      \r\n        static readonly string _predictSingleImage = Path.Combine(_imagesFolder, \"page10.jpg\");\r\n        static readonly string _inceptionTensorFlowModel = Path.Combine(_assetsPath, \"models\",\"frozen_east_text_detection.pb\");\r\n\r\n        private const int imageHeight = 3104;// 576;  It should be multiple by 32\r\n        private const int imageWidth  = 2304; //576;  It should be multiple by 32\r\n        private const int numChannels = 3;\r\n        private const int inputSize = imageHeight * imageWidth * numChannels;`\r\n\r\n\r\nthen I load the TensorFlow model and saved as ML.net model\r\n\r\n`using var modelX = mlContext.Model.LoadTensorFlowModel(_inceptionTensorFlowModel);\r\n            var schema = modelX.GetModelSchema();\r\n            var inputchema = modelX.GetInputSchema();\r\n            var pipelineX = modelX.ScoreTensorFlowModel(\r\n                outputColumnNames: new[] { \"feature_fusion/Conv_7/Sigmoid\", \"feature_fusion/concat_3\" }, nameof(OutputScores.output) },\r\n                 inputColumnNames: new[] { \"input_images\" }, addBatchDimensionInput: false); }, addBatchDimensionInput: true);\r\n            List<TensorData> list = new List<TensorData>();\r\n            list.Add(new TensorData() { input = null });\r\n            IEnumerable<TensorData> enumerableData = list;\r\n            var dv = mlContext.Data.LoadFromEnumerable<TensorData>(list);//TensorData\r\n            ITransformer model = pipelineX.Fit(dv);\r\n            Directory.CreateDirectory(\"Model\");\r\n            mlContext.Model.Save(model, inputchema, \"trainedModelEAST3.zip\");`\r\n\r\n\r\nAt this point everything seems to work, but here is my problem with the outputs\r\n\r\nIn OpenCV I load an Image and use this\r\n`cv::dnn::blobFromImage(frame, blob, 1.0, cv::Size(inpWidth, inpHeight), cv::Scalar(123.68, 116.78, 103.94), true, false);    \r\n`\r\nand only using this\r\n\r\n`    detector.setInput(blob);\r\n    tickMeter.start();\r\n    detector.forward(outs, outNames);\r\n    tickMeter.stop();\r\n\r\n    cv::Mat scores = outs[0];\r\n    cv::Mat geometry = outs[1];`\r\n\r\nIt's almost done, my inputs are clear, and my outputs too. But ML.net you need to create a class to hold the sample tensor data. So I did that\r\n\r\n` public class TensorData\r\n        {\r\n            [VectorType(imageHeight, imageWidth, numChannels)]\r\n            [ColumnName(\"input_images\")]\r\n            public float[] input { get; set; }\r\n\r\n\r\n            [ColumnName(\"ImagePath\")]\r\n            public string imageP { get; set; }\r\n            [ColumnName(\"Name\")]\r\n            public string imageN { get; set; }\r\n        }`\r\n\r\nThis is where my confusion began because I know that my input for this model should be like this\r\n\r\n![inputs](https://user-images.githubusercontent.com/60855616/87887590-965b7200-c9f4-11ea-9d17-4bc627ea8792.png)\r\n\r\nusing this seems to work\r\n\r\n`            [VectorType(imageHeight, imageWidth, numChannels)]\r\n            [ColumnName(\"input_images\")]\r\n            public float[] input { get; set; }`\r\n\r\nBut for my outputs and how to pass and image to the model I only guessing.  so using the information about the model's output that I find using Netron:\r\n\r\nThis is the \"scores\"\r\n![outputs1](https://user-images.githubusercontent.com/60855616/87887712-71b3ca00-c9f5-11ea-8a6d-237261c1feb3.png)\r\n \r\nand this is the \"geometry\" (the box that show you where is a word in the image) \r\n![outputs2](https://user-images.githubusercontent.com/60855616/87887726-aa53a380-c9f5-11ea-8c80-8ee082c2159d.png)\r\n\r\nI create the class \r\n\r\n`        class OutputScores\r\n        {\r\n            [ColumnName(\"feature_fusion/concat_3\")]\r\n            public float[] output { get; set; }\r\n\r\n            [ColumnName(\"feature_fusion/Conv_7/Sigmoid\")]\r\n            public float[] output2 { get; set; }\r\n\r\n        }`\r\n\r\nwhite all that I tried to use the predict engine like this using an image (\"jpg\"):\r\n\r\n`            Bitmap bitmapImage = (Bitmap)Image.FromFile(_predictSingleImage);\r\n\r\n            float[] a = new float[(bitmapImage.Height * bitmapImage.Width) * 3];\r\n            Color[] c = new Color[bitmapImage.Height * bitmapImage.Width];\r\n            for (int i = 0; i < bitmapImage.Height * bitmapImage.Width; i++)\r\n            {\r\n                int row = i / bitmapImage.Width;\r\n                int col = i % bitmapImage.Width;\r\n                var pixel = bitmapImage.GetPixel(col, row);\r\n\r\n                c[i] = pixel;\r\n                //a[i + 0] = pixel.ToArgb();\r\n                a[i * 3 + 0] = pixel.R;\r\n                a[i * 3 + 1] = pixel.G;\r\n                a[i * 3 + 2] = pixel.B;\r\n            }\r\n            var aux = c.ToArray();\r\n\r\n            TensorData imageTensorData = new TensorData()\r\n            {\r\n                input = a.ToArray()\r\n            };\r\n\r\n\r\n            PredictionEngine<TensorData, OutputScores> _predictionEngineX;\r\n            var loadedModelX = mlContex.Model.Load(\"trainedModelEAST3.zip\", out _);\r\n            _predictionEngineX = mlContex.Model.CreatePredictionEngine<TensorData, OutputScores>(loadedModelX);\r\n            var predictionX = _predictionEngineX.Predict(imageTensorData);\r\n            `\r\n\r\nthat gave this results:\r\n\r\nFor the \"geometry\"\r\n-\t\toutput\t{float[2234880]}\tfloat[]\r\n\t\t[0]\t164.553131\tfloat\r\n\t\t[1]\t108.803284\tfloat\r\n\t\t[2]\t88.53912\t        float\r\n\t\t[3]\t157.4754\t        float\r\n\t\t[4]\t-0.00642232737\tfloat\r\n\t\t[5]\t121.783844\tfloat\r\n\t\t[6]\t93.6575\t        float\r\n\t\t[7]\t89.14729\t        float\r\n\t\t[8]\t149.1378\t        float\r\n\t\t[9]\t0.003307178\tfloat\r\n\t\t[10]\t143.044312\tfloat\r\n\t\t[11]\t92.95393\t        float\r\n\t\t[12]\t93.75145\t        float\r\n\t\t[13]\t136.486084\tfloat\r\n\t\t[14]\t-0.00365050742\tfloat\r\n\t\t[15]\t150.783173\tfloat\r\n\t\t[16]\t105.081482\tfloat\r\n\t\t[17]\t104.515717\tfloat\r\n\t\t[18]\t138.529785\tfloat\r\n\t\t[19]\t0.00163079088\tfloat\r\n\t\t[20]\t155.030853\tfloat\r\n\r\n\r\nFor the scores:\r\n-\t\toutput2\t{float[446976]}\tfloat[]\r\n\t\t[0]\t5.96046448E-08\tfloat\r\n\t\t[1]\t2.38418579E-07\tfloat\r\n\t\t[2]\t2.38418579E-07\tfloat\r\n\t\t[3]\t4.76837158E-07\tfloat\r\n\t\t[4]\t2.682209E-07\t        float\r\n\t\t[5]\t1.49011612E-07\tfloat\r\n\t\t[6]\t3.27825546E-07\tfloat\r\n\t\t[7]\t5.662441E-07\t        float\r\n\t\t[8]\t3.27825546E-07\tfloat\r\n\t\t[9]\t5.066395E-07\t        float\r\n\t\t[10]\t1.10268593E-06\tfloat\r\n\t\t[11]\t1.10268593E-06\tfloat\r\n\t\t[12]\t1.22189522E-06\tfloat\r\n\t\t[13]\t1.10268593E-06\tfloat\r\n\t\t[14]\t6.854534E-07\t        float\r\n\t\t[15]\t4.76837158E-07\tfloat\r\n\t\t[16]\t2.682209E-07\t        float\r\n\t\t[17]\t2.682209E-07\t        float\r\n\t\t[18]\t1.49011612E-07\tfloat\r\n\t\t[19]\t2.38418579E-07\tfloat\r\n\t\t[20]\t1.49011612E-07\tfloat\r\n\r\nWell that is how far I went. Could some one tell me If I implemented the loading of Image correctly or not.  My end goal is to have the same or similar result as in OpenCV \r\n\r\nthis are the packages I am using:\r\n\r\n![Packages](https://user-images.githubusercontent.com/60855616/87889195-63b67700-c9fe-11ea-8b9b-198e6513bbc3.png)\r\n\r\nand yes I tried this to create a pipeline:\r\n\r\n`var imagesDataFile = @\"..\\..\\DNN_ML_CUDA_01\\assets\\imagesText\\\";\r\n\r\n\r\n            var data = mlContext.Data.CreateTextLoader(new TextLoader.Options()\r\n            {\r\n                Columns = new[]\r\n                {\r\n                        new TextLoader.Column(\"ImagePath\", DataKind.String, 0),\r\n                        new TextLoader.Column(\"Name\", DataKind.String, 1),\r\n                        new TextLoader.Column(\"input_images\", DataKind.Single , 2),\r\n                }\r\n            }).Load(imagesDataFile);\r\n\r\n            var imagesFolder = Path.GetDirectoryName(imagesDataFile);\r\n            // Image loading pipeline. \r\n            var pipelineI = mlContext.Transforms.LoadImages(\"ImageObject\",\r\n                imagesFolder, \"ImagePath\")\r\n                .Append(mlContext.Transforms.ResizeImages(\"ImageObjectResized\",\r\n                    inputColumnName: \"ImageObject\", imageWidth: imageWidth, imageHeight: imageHeight))\r\n                .Append(mlContext.Transforms.ExtractPixels(\"Pixels\",\r\n                    \"ImageObjectResized\"))\r\n                .Append(mlContext.Model.LoadTensorFlowModel(_inceptionTensorFlowModel)\r\n                              .ScoreTensorFlowModel(\r\n                                     outputColumnNames: new[] { \"feature_fusion/Conv_7/Sigmoid\", \"feature_fusion/concat_3\" },\r\n                                     inputColumnNames: new[] { \"input_images\" },\r\n                                     addBatchDimensionInput: false))\r\n                ;\r\n\r\n            List<TensorData> list = new List<TensorData>();\r\n            list.Add(new TensorData() { input = null });\r\n            IEnumerable<TensorData> enumerableData = list;\r\n            var dvv = mlContext.Data.LoadFromEnumerable<TensorData>(list);//TensorData\r\n\r\n            var model = pipelineI.Fit(dvv);\r\n\r\n\r\n            using var modelX = mlContext.Model.LoadTensorFlowModel(_inceptionTensorFlowModel);\r\n            var testeschema1 = modelX.GetInputSchema();\r\n\r\n            Directory.CreateDirectory(\"Model\");\r\n            mlContext.Model.Save(model, testeschema1, \"trainedModelEAST3.zip\");\r\n`\r\nIt gave me the same results\r\n\r\nfor reference these are the websites that I use for this project:\r\n\r\nhttps://docs.microsoft.com/en-us/dotnet/api/microsoft.ml.imageestimatorscatalog.loadimages?view=ml-dotnet\r\n\r\nhttps://github.com/dotnet/machinelearning/blob/master/docs/code/MlNetCookBook.md#how-do-i-train-my-model-on-categorical-data\r\n\r\nhttps://docs.microsoft.com/en-us/dotnet/api/microsoft.ml.imageestimatorscatalog.extractpixels?view=ml-dotnet\r\n\r\nhttps://devblogs.microsoft.com/cesardelatorre/run-with-ml-net-c-code-a-tensorflow-model-exported-from-azure-cognitive-services-custom-vision/\r\n\r\nhttps://www.pyimagesearch.com/2018/08/20/opencv-text-detection-east-text-detector/\r\n\r\nhttps://devblogs.microsoft.com/cesardelatorre/training-image-classification-recognition-models-based-on-deep-learning-transfer-learning-with-ml-net/\r\n\r\nhttps://docs.microsoft.com/en-us/dotnet/api/microsoft.ml.transforms.tensorflowmodel.scoretensorflowmodel?view=ml-dotnet\r\n\r\nhttps://github.com/dotnet/machinelearning/issues/5286\r\n\r\nhttps://github.com/dotnet/machinelearning-samples/tree/master/samples/csharp/getting-started/DeepLearning_ImageClassification_TensorFlow\r\n\r\nIf somebody could show me an example, of guide me or anything that would be great.","Url":"https://github.com/dotnet/machinelearning/issues/5314","RelatedDescription":"Closed issue \"My confusion trying to use EAST text detector model with the ML.net\" (#5314)"},{"Id":"663385377","IsPullRequest":false,"CreatedAt":"2020-07-23T21:33:13","Actor":"CBrauer","Number":"5318","RawContent":null,"Title":"Transformers and AutoML","State":"closed","Body":"### System information\r\n\r\n- Microsoft Visual Studio Professional 2019, Version 16.6.4\r\n- ML.NET 1.5.1\r\n\r\n### Issue\r\n\r\n- I am trying to do data preparation with AutoML.\r\nI have run my code with, and without, the \"NormalizeMeanVariance\" transform, and I'm getting a much poorer result with the transform. I must be doing something wrong because applying this transform should not produce poorer results.\r\n\r\nHere is a snapshot of my results:\r\n![transform](https://user-images.githubusercontent.com/1317234/88118539-a7ca8880-cb72-11ea-8b27-4c1ff13607d7.png)\r\n\r\n### Reproducible solution files:\r\nThe complete reproducible solution can be downloaded from: https://github.com/CBrauer/Transform-and-AutoML\r\n\r\n\r\n### Here is the main code of the solution.\r\n\r\n```\r\nusing System;\r\nusing System.Diagnostics;\r\nusing System.Linq;\r\n\r\nusing Microsoft.ML;\r\nusing Microsoft.ML.AutoML;\r\nusing Microsoft.ML.Data;\r\n\r\nusing MLLibrary;\r\n\r\nnamespace BottleRocketClassify {\r\n\r\n  internal static class Program {\r\n    public const string trainedModelPath = \"../../../MLModel.zip\";\r\n\r\n    #region PrintMetrics\r\n    #region BinaryExperimentProgressHandler\r\n    #region Head\r\n\r\n    public static class ModelBuilder {\r\n      public static void Run() {\r\n        var mlContext = new MLContext(seed: 1);\r\n\r\n        var trainDataView = mlContext.Data.LoadFromTextFile<ModelInput>(\r\n          path: @\"H:/HedgeTools/Datasets/rocket-train-classify.csv\",\r\n          // path: @\"../../../rocket-train-classify.csv\",\r\n          hasHeader: true,\r\n          separatorChar: ',');\r\n\r\n        Head(trainDataView, 5);\r\n\r\n        var validDataView = mlContext.Data.LoadFromTextFile<ModelInput>(\r\n          path: @\"H:/HedgeTools/Datasets/rocket-valid-classify.csv\",\r\n          hasHeader: true,\r\n          separatorChar: ',');\r\n\r\n        var pipeline = mlContext.Transforms.NormalizeMeanVariance(\"BoxRatio\")\r\n                                .Append(mlContext.Transforms.NormalizeMeanVariance(\"Thrust\"))\r\n                                .Append(mlContext.Transforms.NormalizeMeanVariance(\"Acceleration\"))\r\n                                .Append(mlContext.Transforms.NormalizeMeanVariance(\"Velocity\"))\r\n                                .Append(mlContext.Transforms.NormalizeMeanVariance(\"vwapGain\"))\r\n                                .Append(mlContext.Transforms.NormalizeMeanVariance(\"OnBalRun\"))\r\n                                .AppendCacheCheckpoint(mlContext);\r\n\r\n        var model = pipeline.Fit(trainDataView);\r\n        var transformedTrainDataView = model.Transform(trainDataView);\r\n        Head(transformedTrainDataView, 5);\r\n\r\n        var optimizingMetrics = new BinaryClassificationMetric[4];\r\n        optimizingMetrics[0] = BinaryClassificationMetric.F1Score;\r\n        optimizingMetrics[1] = BinaryClassificationMetric.AreaUnderRocCurve;\r\n        optimizingMetrics[2] = BinaryClassificationMetric.AreaUnderPrecisionRecallCurve;\r\n        optimizingMetrics[3] = BinaryClassificationMetric.PositiveRecall;\r\n\r\n        var trainers = new BinaryClassificationTrainer[1];\r\n        trainers[0] = BinaryClassificationTrainer.FastTree; \r\n     // trainers[1] = BinaryClassificationTrainer.LightGbm;\r\n\r\n        var bestMetric = 0.0;\r\n        foreach (var trainer in trainers) {\r\n          foreach (var optimizingMetric in optimizingMetrics) {\r\n            var sw = Stopwatch.StartNew();\r\n\r\n            var settings = new BinaryExperimentSettings {\r\n              MaxExperimentTimeInSeconds = 1 * 60 * 60,\r\n              OptimizingMetric = optimizingMetric,\r\n              CacheDirectory = null\r\n            };\r\n            settings.Trainers.Clear();\r\n            settings.Trainers.Add(trainer);\r\n\r\n            Console.WriteLine(\"\\n_____________________________________________________________________________\\n\" +\r\n                              \"Running AutoML binary classification experimeent using: \" +\r\n                              trainer + \", \" + optimizingMetric);\r\n\r\n            var experimentResult = mlContext.Auto()\r\n                                            .CreateBinaryClassificationExperiment(settings)\r\n                                            .Execute(trainData: transformedTrainDataView,\r\n           //                               .Execute(trainData: trainDataView,\r\n                                                     validDataView,\r\n                                                     labelColumnName: \"Altitude\",\r\n                                                     progressHandler: new BinaryExperimentProgressHandler());\r\n\r\n            var bestRun = experimentResult.BestRun;\r\n\r\n            Console.WriteLine(\"Total models produced.... {0}\", experimentResult.RunDetails.Count());\r\n            var validDataViewWithBestScore = bestRun.Model.Transform(validDataView);\r\n            var validMetrics = mlContext.BinaryClassification.\r\n                                         EvaluateNonCalibrated(data: validDataViewWithBestScore,\r\n                                                               labelColumnName: \"Altitude\");\r\n            // Console.WriteLine(\"\\nMetrics using validation dataset:\");\r\n            // PrintMetrics(validMetrics);\r\n\r\n            var crossValidationResults = mlContext.BinaryClassification\r\n                                                  .CrossValidateNonCalibrated(validDataView,\r\n                                                                              bestRun.Estimator,\r\n                                                                              numberOfFolds: 10,\r\n                                                                              labelColumnName:   \"Altitude\"); \r\n                                                                \r\n            var metricsInMultipleFolds = crossValidationResults.Select(r => r.Metrics);\r\n\r\n            var AccuracyValues = metricsInMultipleFolds.Select(m => m.Accuracy);\r\n            var accuracyValues = AccuracyValues as double[] ?? AccuracyValues.ToArray();\r\n            var AccuracyAverage = accuracyValues.Average();\r\n\r\n            var F1Values = metricsInMultipleFolds.Select(m => m.F1Score);\r\n            var f1Values = F1Values as double[] ?? F1Values.ToArray();\r\n            var F1Average = f1Values.Average();\r\n\r\n            var AUCValues = metricsInMultipleFolds.Select(m => m.AreaUnderRocCurve);\r\n            var aucValues = AUCValues as double[] ?? AUCValues.ToArray();\r\n            var AUCAverage = aucValues.Average();\r\n\r\n            var AUCPRCValues = metricsInMultipleFolds.Select(m => m.AreaUnderPrecisionRecallCurve);\r\n            var aucPRCValues = AUCPRCValues as double[] ?? AUCPRCValues.ToArray();\r\n            var AUCPRCAverage = aucPRCValues.Average();\r\n\r\n            var sumOfSquaresOfDifferences = accuracyValues.Select(val => (val - AccuracyAverage) * (val - AccuracyAverage)).Sum();\r\n            var AccuraciesStdDeviation = Math.Sqrt(sumOfSquaresOfDifferences / (accuracyValues.Length - 1));\r\n            var confidenceInterval95 = 1.96 * AccuraciesStdDeviation / Math.Sqrt((accuracyValues.Length - 1));\r\n            var AccuraciesConfidenceInterval95 = confidenceInterval95;\r\n\r\n            Console.WriteLine(\"CrossValidation Metrics using the validation dataset:\");\r\n            Console.WriteLine(\"  trainer......................... {0}\", bestRun.TrainerName);\r\n            Console.WriteLine(\"  optimizingMetric................ {0}\", optimizingMetric);\r\n            Console.WriteLine(\"  AccuracyAverage................. {0}\", AccuracyAverage);\r\n            Console.WriteLine(\"  F1Average....................... {0}\", F1Average);\r\n            Console.WriteLine(\"  AUCAverage...................... {0}\", AUCAverage);\r\n            Console.WriteLine(\"  AUCPRCAverage................... {0}\", AUCPRCAverage);\r\n            Console.WriteLine(\r\n              \"  Cross Validation, AUC........... {0:f4}, Standard deviation: {1:f4}, Confidence Interval 95%: {2:f4}\",\r\n              AccuracyAverage, AccuraciesStdDeviation, AccuraciesConfidenceInterval95);\r\n\r\n            if (AccuracyAverage > bestMetric) {\r\n              bestMetric = AccuracyAverage;\r\n              var bestTrainer = bestRun.TrainerName;\r\n              var bestOptimizingMetric = optimizingMetric.ToString();\r\n              Console.WriteLine(\"\\n  Best model's trainer............... {0}\", bestTrainer);\r\n              Console.WriteLine(\"Best model's optimizingMetric........ {0}\", bestOptimizingMetric);\r\n              Console.WriteLine(\"Best model's AccuracyAverage......... {0}\", AccuracyAverage);\r\n              Console.WriteLine(\"Best model's F1Average............... {0}\", F1Average);\r\n              Console.WriteLine(\"Best model's AUCAverage.............. {0}\", AUCAverage);\r\n              Console.WriteLine(\"Best model's AUCPRCAverage........... {0}\", AUCPRCAverage);\r\n\r\n              var mlModel = bestRun.Model;\r\n              mlContext.Model.Save(mlModel, trainDataView.Schema, trainedModelPath);\r\n              Console.WriteLine(\"The model is saved.\");\r\n\r\n              Console.WriteLine(\"\\n_____________________________________________________________________________\");\r\n              var savedModel = mlContext.Model.Load(trainedModelPath, out _);\r\n              var validDataViewWithBestScore2 = savedModel.Transform(validDataView);\r\n              var validMetrics2 = mlContext.BinaryClassification.EvaluateNonCalibrated(data: validDataViewWithBestScore2,\r\n                                                                                       labelColumnName: \"Altitude\");\r\n              Console.WriteLine(\"\\nConfusion Matrix from saved model using the validation dataset:\\n{0}\",\r\n                                validMetrics2.ConfusionMatrix.GetFormattedConfusionTable());\r\n            }\r\n            sw.Stop();\r\n            var ts = sw.Elapsed;\r\n            Console.WriteLine((\"Experiment time: {0:00}:{1:00}:{2:00}\", ts.Hours, ts.Minutes, ts.Seconds));\r\n          }\r\n        }\r\n        Console.WriteLine(\"Done.\");\r\n      }\r\n    }\r\n\r\n    private static void Main() {\r\n      ModelBuilder.Run();\r\n\r\n      var testDataset = @\"H:/HedgeTools/Datasets/rocket-test-classify.csv\";\r\n      Verify.Model(trainedModelPath, testDataset);\r\n      Console.WriteLine(\"Done.\");\r\n      Console.ReadKey();\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\n```\r\n\r\nAny suggestions or help will be greatly appreciated.\r\nCharles\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5318","RelatedDescription":"Closed issue \"Transformers and AutoML\" (#5318)"},{"Id":"664736428","IsPullRequest":false,"CreatedAt":"2020-07-23T20:12:09","Actor":"Aleksey1555","Number":"5323","RawContent":null,"Title":": 'Schema mismatch for input column 'data': expected Vector<Byte, 45, 45, 3>, got Vector<Byte> '","State":"open","Body":"### System information\r\n\r\n- **OS version/distro**: Windows 10 64\r\n- **.NET Version (eg., dotnet --info)**:  Net Core 3.1\r\n\r\n### Issue\r\n\r\n- **What did you do?** :  Try to load images from folder as byte [], then load data into Bitmap and then  createEnumareable\r\n- **What happened?** : Error  Type 'System.Drawing.Bitmap' is not yet supported.   in ConvertToImage\r\n- **What did you expect?** Expect to make array of abjects with Bitmap field\r\n\r\n### Source code / logs\r\ni Have class:\r\npublic class MyImage\r\n    {\r\n        public string Label { get; set; }\r\n        public string path { get; set; }\r\n        [VectorType(45, 45, 3)]\r\n        public byte[] data { get; set; }\r\n        [ImageType(3, 4)]\r\n        public Bitmap im { get; set; }\r\n    }\r\n\r\nand the code:\r\n\r\n```\r\nMLContext ml = new MLContext();\r\n string folder = @\"here my path to folder with images\";\r\n\r\n// Simple function to load images and populate MyImage class (Label and path properties)\r\n IEnumerable<MyImage> images = LoadImagesFromDirectory3(folder: folder, useFolderNameAsLabel: true);\r\n IDataView data = ml.Data.LoadFromEnumerable<MyImage>(images);\r\n IDataView data2 = ml.Transforms.LoadRawImageBytes(\"data\", folder, \"path\")\r\n                                    .Fit(data).Transform(data);\r\n \r\n // And here i want to from data2 make data3 ( with im field)\r\n// but here i get error:'Schema mismatch for input column 'data': expected Vector<Byte, 45, 45, 3>, got Vector<Byte> '\r\n  IDataView data3 = ml.Transforms.ConvertToImage(45, 45, \"im\", \"data\")\r\n                                     .Fit(data2).Transform(data2);\r\n  // And now i want to convert from data3 of type IDataView to List<MyImage>\r\n  // And here\r\n  IEnumerable<MyImage> res=ml.Data.CreateEnumerable<MyImage>(data3, false)\r\n // and after that, i want to save images to the disk\r\n```\r\n`\r\n\r\nPlease help.\r\nWhat i do wrong?","Url":"https://github.com/dotnet/machinelearning/issues/5323","RelatedDescription":"Open issue \": 'Schema mismatch for input column 'data': expected Vector<Byte, 45, 45, 3>, got Vector<Byte> '\" (#5323)"},{"Id":"664709250","IsPullRequest":false,"CreatedAt":"2020-07-23T19:18:24","Actor":"crazyoutlook","Number":"5322","RawContent":null,"Title":"ML.Net Invalid GraphDef - Object Detection Model","State":"open","Body":"### System information\r\n\r\n- **OS version/distro**: Windows 10 Pro\r\n- **.NET Version (eg., dotnet --info)**: dotnet framework 4.7\r\n\r\n### Issue\r\n\r\nWe are working on how to consume the tensorflow model in .Net using ML.NET. We are using below tutorial as reference :\r\n\r\nTutorial Link : https://docs.microsoft.com/en-us/dotnet/machine-learning/tutorials/image-classification\r\n\r\nWe tested with model that is used in the Tutorial and it worked fine. But, when we replace tutorial model with our tensorflow model (object detection model which we have exported from Azure Custom Vision), it is throwing an Exception saying ‘Invalid GraphDef’, while loading the tensor flow model. The same custom vision model works fine when consumed in Python code.\r\n\r\n### Source code / logs\r\n\r\nDetails:\r\n\r\nProject Name : TransferLearningTF \r\nClass name : program.cs \r\nMethod Name : GenerateModel \r\n\r\nCode : \r\nIEstimator<ITransformer> pipeline = mlContext.Transforms.LoadImages(outputColumnName: \"input\", imageFolder: _imagesFolder, inputColumnName: nameof(ImageData.ImagePath))\r\n                                                                                              .Append(mlContext.Model.LoadTensorFlowModel(_inceptionTensorFlowModel)\r\n                                                                                                                .ScoreTensorFlowModel(outputColumnNames: new[] { \"softmax2_pre_activation\" }, inputColumnNames: new[] { \"input\" }, addBatchDimensionInput: true))\r\n\r\nException Details : \r\n\r\nException Message : Tensorflow exception triggered while loading model\r\nSource : Microsoft.ML.TensorFlow\r\nStacktrace :  \r\n   at Microsoft.ML.TensorFlow.TensorFlowUtils.LoadTFSessionByModelFilePath(IExceptionContext ectx, String modelFile, Boolean metaGraph)\r\n   at Microsoft.ML.TensorFlow.TensorFlowUtils.GetSession(IHostEnvironment env, String modelPath, Boolean metaGraph)\r\n   at Microsoft.ML.TensorFlow.TensorFlowUtils.LoadTensorFlowModel(IHostEnvironment env, String modelPath)\r\n   at Microsoft.ML.TensorflowCatalog.LoadTensorFlowModel(ModelOperationsCatalog catalog, String modelLocation)\r\n   at PredictionModel.Program.GenerateModel(MLContext mlContext) in D:\\Cognitive-Samples-VideoFrameAnalysis-master\\Windows\\PredictionModel\\Program.cs:line 35\r\n   at PredictionModel.Program.Main(String[] args) in D:\\Cognitive-Samples-VideoFrameAnalysis-master\\Windows\\PredictionModel\\Program.cs:line 22\r\n\r\nInner Exception:\r\n\r\nException  Message  : Invalid GraphDef\r\nSource :  TensorFlow.NET\r\nStack trace : \r\n   at Tensorflow.Status.Check(Boolean throwException)\r\n   at Tensorflow.Graph.Import(Byte[] bytes, String prefix)\r\n   at Tensorflow.Graph.Import(String file_path, String prefix)\r\n   at Microsoft.ML.TensorFlow.TensorFlowUtils.LoadTFSessionByModelFilePath(IExceptionContext ectx, String modelFile, Boolean metaGraph)\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5322","RelatedDescription":"Open issue \"ML.Net Invalid GraphDef - Object Detection Model\" (#5322)"},{"Id":"664584785","IsPullRequest":false,"CreatedAt":"2020-07-23T15:45:13","Actor":"Babadinier","Number":"5321","RawContent":null,"Title":"System.ArgumentException: Destination is too short. (Parameter 'destination')","State":"open","Body":"### System information\r\n\r\n.NET Core SDK (reflecting any global.json):\r\nVersion: 3.1.301\r\nCommit: 7feb845744\r\n\r\n \r\n\r\nRuntime Environment:\r\n\r\nOS Name: Windows\r\n\r\nOS Version: 10.0.14393\r\n\r\nOS Platform: Windows\r\n\r\nRID: win10-x86\r\n\r\nBase Path: D:\\Program Files (x86)\\dotnet\\sdk\\3.1.301\\\r\n\r\n \r\n\r\nHost (useful for support):\r\n\r\nVersion: 3.1.5\r\n\r\nCommit: 65cd789777\r\n\r\n \r\n\r\n.NET Core SDKs installed:\r\n\r\n1.1.14 [D:\\Program Files (x86)\\dotnet\\sdk]\r\n\r\n2.1.514 [D:\\Program Files (x86)\\dotnet\\sdk]\r\n\r\n2.1.515 [D:\\Program Files (x86)\\dotnet\\sdk]\r\n\r\n2.2.109 [D:\\Program Files (x86)\\dotnet\\sdk]\r\n\r\n3.1.202 [D:\\Program Files (x86)\\dotnet\\sdk]\r\n\r\n3.1.301 [D:\\Program Files (x86)\\dotnet\\sdk]\r\n\r\n \r\n\r\n.NET Core runtimes installed:\r\n\r\nMicrosoft.AspNetCore.All 2.1.17 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.All]\r\n\r\nMicrosoft.AspNetCore.All 2.1.19 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.All]\r\n\r\nMicrosoft.AspNetCore.All 2.2.8 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.All]\r\n\r\nMicrosoft.AspNetCore.App 2.1.17 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n\r\nMicrosoft.AspNetCore.App 2.1.19 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n\r\nMicrosoft.AspNetCore.App 2.2.8 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n\r\nMicrosoft.AspNetCore.App 3.0.3 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n\r\nMicrosoft.AspNetCore.App 3.1.3 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n\r\nMicrosoft.AspNetCore.App 3.1.5 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n\r\nMicrosoft.NETCore.App 1.0.16 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\nMicrosoft.NETCore.App 1.1.13 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\nMicrosoft.NETCore.App 2.0.9 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\nMicrosoft.NETCore.App 2.1.19 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\nMicrosoft.NETCore.App 2.2.8 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\nMicrosoft.NETCore.App 3.0.3 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\nMicrosoft.NETCore.App 3.1.5 [D:\\Program Files (x86)\\dotnet\\shared\\Microsoft.NETCore.App]\r\n\r\n### Issue\r\n\r\n- We have implemented a service using ML.Net to analyze email messages.  In certain cases, when sending a request to analyze we get the following error, which results in a 400 status reply from our service.  When trying the same payload a couple of minutes later we get a correct 200 reply without error.\r\nWe would expect that ML always returns the same result when provided with the same payload?\r\n\r\nSystem.ArgumentException: Destination is too short. (Parameter 'destination')\r\n   at Microsoft.ML.Data.BufferBuilder`1.GetResult(VBuffer`1& buffer)\r\n   at Microsoft.ML.Transforms.Text.NgramExtractingTransformer.Mapper.<>c__DisplayClass10_0.<MakeGetter>b__2(VBuffer`1& dst)\r\n   at Microsoft.ML.Transforms.LpNormNormalizingTransformer.Mapper.<>c__DisplayClass8_0.<MakeGetter>b__5(VBuffer`1& dst)\r\n   at Microsoft.ML.Data.ColumnConcatenatingTransformer.Mapper.BoundColumn.<>c__DisplayClass18_0`1.<MakeGetter>b__0(VBuffer`1& dst)\r\n   at Microsoft.ML.Data.ColumnConcatenatingTransformer.Mapper.BoundColumn.<>c__DisplayClass18_0`1.<MakeGetter>b__0(VBuffer`1& dst)\r\n   at Microsoft.ML.Data.SchemaBindablePredictorWrapperBase.<>c__DisplayClass18_0`2.<GetValueGetter>b__0(TDst& dst)\r\n   at Microsoft.ML.Data.PredictedLabelScorerBase.EnsureCachedPosition[TScore](Int64& cachedPosition, TScore& score, DataViewRow boundRow, ValueGetter`1 scoreGetter)\r\n   at Microsoft.ML.Data.MulticlassClassificationScorer.<>c__DisplayClass16_0.<GetPredictedLabelGetter>b__0(UInt32& dst)\r\n   at Microsoft.ML.Transforms.KeyToValueMappingTransformer.Mapper.KeyToValueMap`2.<>c__DisplayClass8_0.<GetMappingGetter>b__0(TValue& dst)\r\n   at Microsoft.ML.Data.TypedCursorable`1.TypedRowBase.<>c__DisplayClass9_0`2.<CreateConvertingActionSetter>b__0(TRow row)\r\n   at Microsoft.ML.Data.TypedCursorable`1.TypedRowBase.FillValues(TRow row)\r\n   at Microsoft.ML.Data.TypedCursorable`1.RowImplementation.FillValues(TRow row)\r\n   at Microsoft.ML.PredictionEngineBase`2.FillValues(TDst prediction)\r\n   at Microsoft.ML.PredictionEngine`2.Predict(TSrc example, TDst& prediction)\r\n   at sar.svc.ml.alex.business.services.MailPredictionService.GetIntents(Mail mail) in D:\\a\\1\\s\\sar.svc.ml.alex.business\\services\\MailPredictionService.cs:line 26\r\n\r\n\r\n```csharp      \r\npublic Dictionary<string, float> GetIntents(Mail mail)\r\n        {\r\n            if (mail == null)\r\n            {\r\n                throw new ArgumentNullException(nameof(mail));\r\n            }\r\n\r\n            var prediction = predictionEngine.Engine.Predict(mail);\r\n\r\n            return BuildIntents(predictionEngine.Engine.OutputSchema, prediction.Score);\r\n        }\r\n```","Url":"https://github.com/dotnet/machinelearning/issues/5321","RelatedDescription":"Open issue \"System.ArgumentException: Destination is too short. (Parameter 'destination')\" (#5321)"},{"Id":"662794188","IsPullRequest":false,"CreatedAt":"2020-07-22T21:08:17","Actor":"klesouza","Number":"5315","RawContent":null,"Title":"Load native LightGBM exported text file","State":"closed","Body":"### Issue\r\n\r\n- I would like to be able to load a LightGBM model exported from the native library in text format directly in ML.NET LightGBM implementation.\r\n\r\nI noticed there are bindings to the save method here https://github.com/dotnet/machinelearning/blob/8631afaaaa60daa1bda734dc79d92433591f7917/src/Microsoft.ML.LightGbm/WrappedLightGbmInterface.cs#L190, but couldn't find a way to load the text file\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5315","RelatedDescription":"Closed issue \"Load native LightGBM exported text file\" (#5315)"},{"Id":"663994500","IsPullRequest":false,"CreatedAt":"2020-07-22T19:23:02","Actor":"vffuunnyy","Number":"5320","RawContent":null,"Title":"The input string was not formatted correctly","State":"open","Body":"Model Builder Error\r\n\r\nVisual studio 2019 last version\r\nML.NET last version\r\nwindows 8.1 x64\r\ninput data: https://yadi.sk/d/dOH4eg9ojMV4gA\r\nTraining stops after this log line:\r\n`|63   OlsRegression                         0,0000          5,55       428,48    20,70      55,0         63      |`\r\n\r\ntrace:\r\n```\r\nв System.Number.ParseSingle(String value, NumberStyles options, NumberFormatInfo numfmt)\r\n   в Microsoft.ML.AutoML.SweeperProbabilityUtils.ParameterSetAsFloatArray(IValueGenerator[] sweepParams, ParameterSet ps, Boolean expandCategoricals)\r\n   в Microsoft.ML.AutoML.SmacSweeper.FitModel(IEnumerable`1 previousRuns)\r\n   в Microsoft.ML.AutoML.SmacSweeper.ProposeSweeps(Int32 maxSweeps, IEnumerable`1 previousRuns)\r\n   в Microsoft.ML.AutoML.PipelineSuggester.SampleHyperparameters(MLContext context, SuggestedTrainer trainer, IEnumerable`1 history, Boolean isMaximizingMetric)\r\n   в Microsoft.ML.AutoML.PipelineSuggester.GetNextInferredPipeline(MLContext context, IEnumerable`1 history, DatasetColumnInfo[] columns, TaskKind task, Boolean isMaximizingMetric, CacheBeforeTrainer cacheBeforeTrainer, IEnumerable`1 trainerWhitelist)\r\n   в Microsoft.ML.AutoML.Experiment`2.Execute()\r\n   в Microsoft.ML.AutoML.ExperimentBase`2.Execute(ColumnInformation columnInfo, DatasetColumnInfo[] columns, IEstimator`1 preFeaturizer, IProgress`1 progressHandler, IRunner`1 runner)\r\n   в Microsoft.ML.AutoML.ExperimentBase`2.Execute(IDataView trainData, ColumnInformation columnInformation, IEstimator`1 preFeaturizer, IProgress`1 progressHandler)\r\n   в Microsoft.ML.ModelBuilder.AutoMLService.Experiments.AutoMLExperiment`3.<>c__DisplayClass21_0.<ExecuteAsync>b__5() в /_/src/Microsoft.ML.ModelBuilder.AutoMLService/Experiments/AutoMLExperiment.cs:строка 81\r\n   в System.Threading.Tasks.Task`1.InnerInvoke()\r\n   в System.Threading.Tasks.Task.Execute()\r\n--- Конец трассировка стека из предыдущего расположения, где возникло исключение ---\r\n   в System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   в System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   в Microsoft.ML.ModelBuilder.AutoMLService.Experiments.AutoMLExperiment`3.<ExecuteAsync>d__21.MoveNext() в /_/src/Microsoft.ML.ModelBuilder.AutoMLService/Experiments/AutoMLExperiment.cs:строка 108\r\n--- Конец трассировка стека из предыдущего расположения, где возникло исключение ---\r\n   в System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   в System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   в Microsoft.ML.ModelBuilder.AutoMLEngine.<StartTrainingAsync>d__30.MoveNext() в /_/src/Microsoft.ML.ModelBuilder.AutoMLService/AutoMLEngineService/AutoMLEngine.cs:строка 147\r\n```","Url":"https://github.com/dotnet/machinelearning/issues/5320","RelatedDescription":"Open issue \"The input string was not formatted correctly\" (#5320)"},{"Id":"663435689","IsPullRequest":true,"CreatedAt":"2020-07-22T02:57:55","Actor":"mstfbl","Number":"5319","RawContent":null,"Title":"Aded catch in R^2 calculation for case with few samples","State":"open","Body":"This PR fixes #5306 by adding a catch for the calculation of `R^2` during metric calculation. When there is less than two rows of data used for the calculation of `R^2`, the returned value becomes `-Infinity`, whereas it should be returning `NaN`.\r\n\r\nAn example of this behavior in another ML framework is in scikit-learn, in the following lines:\r\n\r\nhttps://github.com/scikit-learn/scikit-learn/blob/fd237278e895b42abe8d8d09105cbb82dc2cbba7/sklearn/metrics/_regression.py#L587-L590","Url":"https://github.com/dotnet/machinelearning/pull/5319","RelatedDescription":"Open PR \"Aded catch in R^2 calculation for case with few samples\" (#5319)"},{"Id":"663354166","IsPullRequest":false,"CreatedAt":"2020-07-21T22:57:32","Actor":"JuanJimenezR","Number":"5317","RawContent":null,"Title":"Solicitud de guía para re-entrenar un modelo ya entrenado","State":"closed","Body":"### System information\r\nNA\r\n### Issue\r\n\r\nEstoy logrando con éxito incluir y utilizar el código de uso para mi modelo con el ML builder.\r\n\r\nBusco por cargar un modelo ya entrenado, y volverlo a entrenar con un  adicional conjunto de datos (a fin que el aprendizaje de mi modelo sea escalable sobre lo que ya había aprendido).\r\n\r\nEl código generado por el ML builder,  cargar el modelo y entrena uno NUEVO para el conjunto de datos nuevo, remplazando el que ya existía, esto no me permite continuar \"aprendiendo\" sobre mi modelo previamente entrenado.\r\n\r\nLas documentaciones que encuentro me dirigen al anterior workflow.\r\n\r\nPueden por favor indicarme alguna guía para implementar el work flow deseado:\r\nCargar modelo local ya entrenado.\r\nllamar al entrenador para que entre más el modelo con nuevos datos.\r\nevaluar y guardar localmente el modelo.\r\n\r\nMuchas Gracias!\r\n \r\n\r\n\r\n ","Url":"https://github.com/dotnet/machinelearning/issues/5317","RelatedDescription":"Closed issue \"Solicitud de guía para re-entrenar un modelo ya entrenado\" (#5317)"},{"Id":"663225973","IsPullRequest":false,"CreatedAt":"2020-07-21T18:37:27","Actor":"LeoAlario","Number":"5316","RawContent":null,"Title":"Unable to load DLL 'MklImports' or one of its dependencies: The specified module could not be found. (0x8007007E)","State":"open","Body":"### System information\r\n\r\n- **Windows server 2019 IIS / Docker Windows Container**:\r\n- **.NET Version 3.1.3**: \r\n\r\n**Project references**\r\nMicrosoft.ML 1.5.0 - 1.5.1 \r\nMicrosoft.ML.TimeSeries 1.5.0 - 1.5.1\r\nMicrosoft.ML.Mkl.Components 1.5.0 - 1.5.1 \r\n\r\n\r\n### Issue\r\n\r\n- **What did you do?**\r\n\r\n I was trying to train the model in a .NET standard 2.0 library\r\n\r\n ITransformer trainedModel = dataProcessPipeline.Fit(trainingDataView);\r\n\r\nIt doesn't work on IIS production environment (VM on Azure)  as well in a Docker Windows Container used from my development machine.\r\n\r\nI've performed several attempts in order to solve the  issue, including manual installation of the Intel Math Kernel Library through the installer.   \r\n\r\n- **What happened?**\r\n Dll not found exception\r\n\r\n- **What did you expect?**\r\n\r\nIt should work fine like on my development environment (IIS Express).\r\n\r\n### Source code / logs\r\n\r\nUnable to load DLL 'MklImports' or one of its dependencies: The specified module could not be found. (0x8007007E)    at Microsoft.ML.Transforms.TimeSeries.EigenUtils.Dsytrd(Layout matrixLayout, Uplo uplo, Int32 n, Double[] a, Int32 lda, Double[] d, Double[] e, Double[] tau)\r\n   at Microsoft.ML.Transforms.TimeSeries.EigenUtils.MklSymmetricEigenDecomposition(Single[] input, Int32 size, Single[]& eigenValues, Single[]& eigenVectors)\r\n   at Microsoft.ML.Transforms.TimeSeries.TrajectoryMatrix.ComputeSvd(Single[]& singularValues, Single[]& leftSingularvectors)\r\n   at Microsoft.ML.Transforms.TimeSeries.AdaptiveSingularSpectrumSequenceModelerInternal.TrainCore(Single[] dataArray, Int32 originalSeriesLength)\r\n   at Microsoft.ML.Transforms.TimeSeries.AdaptiveSingularSpectrumSequenceModelerInternal.Train(RoleMappedData data)\r\n   at Microsoft.ML.Transforms.TimeSeries.SsaForecastingEstimator.Fit(IDataView input)\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5316","RelatedDescription":"Open issue \"Unable to load DLL 'MklImports' or one of its dependencies: The specified module could not be found. (0x8007007E)\" (#5316)"},{"Id":"659404170","IsPullRequest":true,"CreatedAt":"2020-07-20T22:32:38","Actor":"michaelgsharp","Number":"5310","RawContent":null,"Title":"RobustScalingNormalizer entrypoint added","State":"closed","Body":"When RobustScalingNormalizer was added, PR #5166, the corresponding entrypoints were not created. This PR fixes #5309 by adding in the correct entrypoint for it.","Url":"https://github.com/dotnet/machinelearning/pull/5310","RelatedDescription":"Closed or merged PR \"RobustScalingNormalizer entrypoint added\" (#5310)"},{"Id":"658646323","IsPullRequest":false,"CreatedAt":"2020-07-20T22:32:38","Actor":"ganik","Number":"5309","RawContent":null,"Title":"Entrypoints for RobustScaler, ToString removed","State":"closed","Body":"ML.NET 1.5.1 breaking changes for NimbusML.\r\nEntrypoints RobustScaler, ToString and CategoryImputer removed.\r\nThe PR was #5209 \r\nNimbusML can do changes for CategoryImputer to use ReplaceMissingValues entrypoint\r\nWe need to expose TypeConvertingTransformer  and NormalizingEstimator as entrypoints\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5309","RelatedDescription":"Closed issue \"Entrypoints for RobustScaler, ToString removed\" (#5309)"},{"Id":"660923423","IsPullRequest":true,"CreatedAt":"2020-07-19T16:15:07","Actor":"jwood803","Number":"5313","RawContent":null,"Title":"Channels await fix","State":"open","Body":"Fix for #5312\r\n\r\nSetting as a draft to add a test.","Url":"https://github.com/dotnet/machinelearning/pull/5313","RelatedDescription":"Open PR \"Channels await fix\" (#5313)"},{"Id":"660740597","IsPullRequest":false,"CreatedAt":"2020-07-19T10:10:13","Actor":"jwood803","Number":"5312","RawContent":null,"Title":"Async operation has not completed error","State":"open","Body":"It seems some scenarios cause this error after looking at this [StackOverflow question](https://stackoverflow.com/questions/62976568/system-invalidoperationexception-the-asynchronous-operation-has-not-completed).\r\n\r\n```\r\nat System.Threading.Channels.AsyncOperation.ThrowIncompleteOperationException() at System.Threading.Channels.AsyncOperation1.GetResult(Int16 token)   at Microsoft.ML.Transforms.RowShufflingTransformer.Cursor.MoveNextCore()\r\n```\r\n\r\nThis seems to be caused by a change I added in #5123. \r\n\r\nTagging @eerhardt @harishsk for visibility. I'll work on a fix for this.","Url":"https://github.com/dotnet/machinelearning/issues/5312","RelatedDescription":"Open issue \"Async operation has not completed error\" (#5312)"},{"Id":"655177865","IsPullRequest":false,"CreatedAt":"2020-07-18T01:03:16","Actor":"jualbina","Number":"5303","RawContent":null,"Title":"Not being able to generate code from model on ML.NET CLI","State":"closed","Body":"### System information\r\n\r\n- **OS version/distro**: Running over Azure Machine Learning compute cluster, not completely sure on the OS behind it.\r\n- **.NET Version (eg., dotnet --info)**: .NET Core 2.0, I believe.\r\n\r\n### Issue\r\n\r\n- **What did you do?**\r\nCLI command performed: _saveModel in=inputs/model.zip code=outputs/code.cs_\r\n\r\n- **What happened?**\r\nI've got the following error message:\r\n_Error during class instantiation\r\nOne of the identified items was in an invalid format._\r\n\r\n- **What did you expect?**\r\nTo have the model code generated.\r\n\r\n### Source code / logs\r\nThe library generated a log file, but since I was running over a dynamically generated Azure Machine Learning compute cluster, I was not able to retrieve it.","Url":"https://github.com/dotnet/machinelearning/issues/5303","RelatedDescription":"Closed issue \"Not being able to generate code from model on ML.NET CLI\" (#5303)"},{"Id":"659786637","IsPullRequest":false,"CreatedAt":"2020-07-18T01:02:08","Actor":"frank-dong-ms","Number":"5311","RawContent":null,"Title":"throw a more useful error if a user loads a newer model than is supported by the current ML․NET version","State":"open","Body":"follow up improvement for below issue: \r\nhttps://github.com/dotnet/machinelearning/issues/5303 \r\n","Url":"https://github.com/dotnet/machinelearning/issues/5311","RelatedDescription":"Open issue \"throw a more useful error if a user loads a newer model than is supported by the current ML․NET version\" (#5311)"},{"Id":"655621175","IsPullRequest":false,"CreatedAt":"2020-07-17T16:59:50","Actor":"horczech","Number":"5305","RawContent":null,"Title":"Length of memory (691200) must match product of dimensions (3).","State":"closed","Body":"### System information\r\n\r\n- **OS version/distro**: Windows 10\r\n- **.NET Version (eg., dotnet --info)**: netcoreapp3.1\r\n\r\n### Issue\r\n\r\n- **What did you do?** I loaded an ONNX model to ML.NET and tried to run it.\r\n- **What happened?** I am getting this exception when trying to do a prediction: \"Length of memory (691200) must match product of dimensions (3)\"\r\n- **What did you expect?** Prediction \r\n\r\n### Source code / logs\r\n\r\nFull error message:\r\n`System.ArgumentException: 'Length of memory (691200) must match product of dimensions (3).'`\r\n\r\nPipeline that I am using:\r\n`            var pipeline = _mlContext.Transforms\r\n                .ResizeImages(\r\n                    outputColumnName: \"resized_image\",\r\n                    imageWidth: 640,\r\n                    imageHeight: 360,\r\n                    inputColumnName: \"image\")\r\n                .Append(_mlContext.Transforms\r\n                    .ExtractPixels(\r\n                        outputColumnName: ModelConfigParameters.InputColumns.First(),\r\n                        outputAsFloatArray: false,\r\n                        colorsToExtract: ImagePixelExtractingEstimator.ColorBits.Rgb,\r\n                        orderOfExtraction: ImagePixelExtractingEstimator.ColorsOrder.ARGB,\r\n                        interleavePixelColors: false,\r\n                        inputColumnName: \"resized_image\"))\r\n                .Append(_mlContext.Transforms\r\n                    .ApplyOnnxModel(\r\n                        modelFile: onnxModelPath,\r\n                        outputColumnNames: ModelConfigParameters.OutputColumns,\r\n                        inputColumnNames: ModelConfigParameters.InputColumns));`\r\n\r\n\r\nInput object to the pipeline:\r\n```\r\npublic class InputImage\r\n{\r\n    [ImageType(width: 640, height: 360)]\r\n    [ColumnName(\"image\")]\r\n    public Bitmap Image { get; set; }\r\n\r\n}\r\n```\r\n\r\nOutput object (predictions):\r\n```\r\npublic class OutputPredictions\r\n{\r\n    [ColumnName(\"detection_scores:0\")]\r\n    public float[] DetectionScores;\r\n\r\n    [ColumnName(\"detection_boxes:0\")]\r\n    public float[] DetectionBoxes;\r\n\r\n    [ColumnName(\"detection_classes:0\")]\r\n    public float[] DetectionClasses;\r\n\r\n    [ColumnName(\"num_detections:0\")]\r\n    public float[] NumDetections;\r\n}\r\n```\r\n\r\n\r\n\r\nThe code that fails on the last line:\r\n```\r\n        var imgPath = @\"some/path/to/image.png\";\r\n        var img = (Bitmap)Image.FromFile(imgPath);\r\n        var inputData = new InputImage() { Image = img };\r\n\r\n        var emptyData = _mlContext.Data.LoadFromEnumerable(new List<InputImage>());\r\n        var model = pipeline.Fit(emptyData);\r\n\r\n        var prediction = _mlContext.Model.CreatePredictionEngine<InputImage, OutputPredictions>(model).Predict(inputData);\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\nWhen I inspect pipeline using the var preview = pipeline.Preview(emptyData); I get this scheme:\r\n![img1_scheme](https://user-images.githubusercontent.com/5252663/87278343-80c1e600-c4e4-11ea-8daf-f2cc4ef0eef2.png)\r\n\r\n\r\n\r\nand the input and output of the ONNX model is following:\r\n\r\n![img2_inout](https://user-images.githubusercontent.com/5252663/87278357-8dded500-c4e4-11ea-8f79-2526764ec316.png)\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5305","RelatedDescription":"Closed issue \"Length of memory (691200) must match product of dimensions (3).\" (#5305)"},{"Id":"657106630","IsPullRequest":false,"CreatedAt":"2020-07-16T15:44:59","Actor":"masayakitazawasan","Number":"5307","RawContent":null,"Title":"how to work 2 inputs to loading ONNX model by ML.NET","State":"closed","Body":"### Question\r\nI built a ONNX model with 2 inputs in python.\r\nONNX with 2 inputs works in python.\r\nBut I can't find any sample code in ML.NET with multiple inputs.\r\nCould you tell me how to build pipline with two inputs in ML.NET ?\r\n\r\n## ONNX Infomation ##\r\n[INPUTNAME]\r\n   input_1 ['None', 224, 224, 3]\r\n   input_2 ['None', 18]\r\n[OUTPUTNAME]\r\n   dense_3 ['None', 5]\r\n\r\n### Source code \r\n##################################################\r\n# ML.NET\r\n##################################################\r\npipeline=imageLoader.Append(imageResizer).Append(pixelExtractor).Append(onnxEstimator);\r\nmodel = pipeline.Fit(data);\r\n* The size of imageResizer is [224,224,3] \r\n\r\n\r\n\r\n##################################################\r\n# Python (2 inputs onnx works)\r\n##################################################\r\n## Prediction Process ##\r\n   x1 = x1.astype(np.float16)\r\n   x2 = x2.astype(np.float16)\r\n   predict = SESS.run([\"dense_3\"],{\"input_1\":x1,\"input_2\":x2})[0]","Url":"https://github.com/dotnet/machinelearning/issues/5307","RelatedDescription":"Closed issue \"how to work 2 inputs to loading ONNX model by ML.NET\" (#5307)"},{"Id":"657943987","IsPullRequest":false,"CreatedAt":"2020-07-16T07:45:34","Actor":"hejingkan2005","Number":"5308","RawContent":null,"Title":"Unable to load DLL 'FastTreeNative' in Azure Function ","State":"open","Body":"### System information\r\n\r\n- **OS version/distro**: win10 (10.0.19041 Build 19041)\r\n- **.NET Version (eg., dotnet --info)**: .net core 3.1\r\n\r\n### Issue\r\n\r\n- **What did you do?**\r\nML.net 1.5.1\r\n- **What happened?**\r\nIt is no issue to run sample code in console app, but it's repeatedly reporting below error when run CreateModel() from a testing azure function:\r\n=============== Training  model ===============\r\n[7/16/2020 7:41:11 AM] Executed 'NormalizeFunction' (Failed, Id=64d8e39f-5a8b-40e9-b335-3cf2cbf4ce45)\r\n[7/16/2020 7:41:11 AM] System.Private.CoreLib: Exception while executing function: NormalizeFunction. System.Private.CoreLib: One or more errors occurred. (Unable to load DLL 'FastTreeNative' or one of its dependencies: The specified module could not be found. (Exception from HRESULT: 0x8007007E)). Microsoft.ML.FastTree: Unable to load DLL 'FastTreeNative' or one of its dependencies: The specified module could not be found. (Exception from HRESULT: 0x8007007E).\r\n- **What did you expect?**\r\nIt should run without exception as it did in console app\r\n\r\n### Source code / logs\r\n\r\nPlease paste or attach the code or logs or traces that would be helpful to diagnose the issue you are reporting.\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5308","RelatedDescription":"Open issue \"Unable to load DLL 'FastTreeNative' in Azure Function \" (#5308)"},{"Id":"653098668","IsPullRequest":false,"CreatedAt":"2020-07-15T07:37:08","Actor":"UlrichSuess","Number":"5293","RawContent":null,"Title":"Opaque disruptive handling of variable axes of ONNX-models","State":"closed","Body":"**### System information**\r\n- Win 10, 1903\r\n- .NET 4.7.2\r\n\r\n**### Issue**\r\nremark: I do have a functional workaround solution, but it requires quite some nasty additional code and probably is a bit slower than optimal.\r\n\r\nThe main point of critique here concerns the OnnxTransform class.\r\n\r\n**What did you do?**\r\nTried to do inference with an ONNX-model for sequence labeling with two variable input axes (batch and sequence).\r\n\r\nThe whole input (3 dimensions: batch, sequence, features) were put into one big float[]. Still not sure whether this is really the correct way. All attempts to use multidimensional input fields failed.\r\n\r\n**What happened?**\r\nAs stated in source code (OnnxTransform.MakeRowMapper(...), see below), dimensions of variable input axes were set to 1, resulting in incorrect batches and sequences of size 1 each, regardless of specified DataView.\r\n\r\nThere is no explicit hint leading to the dimensionality reduction, however. The problem is documented, but that's in a private method. You only get an exception when feeding your whole sequence (as stated as one big float[]), because due to the dimension reduction the set up model expects length 1 * 1 * FeatureLength, and the input vector gets is large for that. At least that exception tells you that the product of the dimensions is relevant.\r\n\r\nThe workaround consists of setting up the \"model\" for each sequence by using the ApplyOnnxModel-overload with the input size dictionary \"shapesDictionary\". The documentation for that overload method is a bit cryptic, though (see below). It does allow to override the reduction to 1 of the variable axes (and only for those!) by using the values in the dictionary, but I learned that from the source code, not from the documentation.\r\n\r\nThe DataView has to be reset for each sequence, too, of course, to contain the specific sequence length.\r\n\r\nTook unnecessarily long to find the source of the problem and the workaround solution.\r\n\r\n**What did you expect?**\r\nBest case: Full support for variable input dimensions, which should extend to the DataView and the model.\r\n\r\n2nd best: Even for my chosen workaround of adjusting everything for each sequence to contain specific sequence length, the model-row-mapper should infer the correct dimensions instead of reducing them to 1 (there IS a todo comment for that). Fortunately, the time for the resets still make the workaround kind of usable. (although at batch size 1, so far, for more padding will probably be necessary, the effect of which remains to be checked)\r\n\r\nAt least: Output some kind of hint that the reduction takes place, at least in the public documentation for ApplyOnnxModel(...) or with further information in the exception when the sizes don't fit.\r\n\r\n\r\n### Source code / logs\r\nFrom OnnxTransform.cs:\r\n\r\n```\r\n        private protected override IRowMapper MakeRowMapper(DataViewSchema inputSchema) => new Mapper(this, inputSchema);\r\n\r\n        /// <summary>\r\n        /// This design assumes that all unknown dimensions are 1s. It also convert scalar shape [] in ONNX to [1].\r\n        /// [TODO] We should infer the unknown shape from input data instead of forcing them to be 1.\r\n        /// </summary>\r\n        private static IEnumerable<int> AdjustDimensions(OnnxShape shape)\r\n        {\r\n            if (shape.Count > 0)\r\n            {\r\n                return shape.Select(x => (x <= 0) ? 1 : x);\r\n            }\r\n            return new[] { 1 };\r\n        }\r\n```\r\n\r\nFrom OnnxCatalog.ApplyOnnxModel(...) not too helpful documentation:\r\n```\r\n        /// <param name=\"shapeDictionary\">ONNX shape should be used to over those loaded from <paramref name=\"modelFile\"/>.</param>\r\n```\r\nsuggestion:\r\n```\r\n        /// <param name=\"shapeDictionary\">Variable dimension sizes as stated in the loaded <paramref name=\"modelFile\"/> are replaced by dimension sizes from this dictionary. All dimensions, also nonvariable, have to be given, though. For keys use names as stated in the ONNX model, e.g. \"input\"</param>\r\n```","Url":"https://github.com/dotnet/machinelearning/issues/5293","RelatedDescription":"Closed issue \"Opaque disruptive handling of variable axes of ONNX-models\" (#5293)"},{"Id":"654938281","IsPullRequest":false,"CreatedAt":"2020-07-14T19:26:47","Actor":"emilylawton","Number":"5299","RawContent":null,"Title":"Unable to load shared library 'CpuMathNative' or one of its dependencies.","State":"closed","Body":"### System information\r\n\r\n- **.NET Version (eg., dotnet --info)**: 3.1\r\n\r\n### Issue\r\n\r\n- **What did you do?**\r\nRan the following command from a published AML experiment pipeline:\r\n`maml.exe TrainTest test=inputs/test.tsv tr=LogisticRegression scorer=BinaryClassifierScorer eval=BinaryClassifierEvaluator norm=No cache=+ dout=outputs/pred.tsv loader=TextLoader{col=Name:TX:3 col=Features:R4:4-222 col=Label:R4:0 header=+} data=inputs/train.tsv out=outputs/model.zip seed=137`\r\n\r\n- **What happened?**\r\n```\r\n(1) Unexpected exception: One or more errors occurred. (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory) (Unable to load shared library 'CpuMathNative' or one of its dependencies. In order to help diagnose loading problems, consider setting the LD_DEBUG environment variable: libCpuMathNative: cannot open shared object file: No such file or directory), 'System.AggregateException'\r\n   at System.Threading.Tasks.TaskReplicator.Run[TState](ReplicatableUserAction`1 action, ParallelOptions options, Boolean stopOnFirstFailure)\r\n   at System.Threading.Tasks.Parallel.ForWorker[TLocal](Int32 fromInclusive, Int32 toExclusive, ParallelOptions parallelOptions, Action`1 body, Action`2 bodyWithState, Func`4 bodyWithLocal, Func`1 localInit, Action`1 localFinally)\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Threading.Tasks.Parallel.ThrowSingleCancellationExceptionOrOtherException(ICollection exceptions, CancellationToken cancelToken, Exception otherException)\r\n   at System.Threading.Tasks.Parallel.ForWorker[TLocal](Int32 fromInclusive, Int32 toExclusive, ParallelOptions parallelOptions, Action`1 body, Action`2 bodyWithState, Func`4 bodyWithLocal, Func`1 localInit, Action`1 localFinally)\r\n   at System.Threading.Tasks.Parallel.For(Int32 fromInclusive, Int32 toExclusive, Action`1 body)\r\n   at Microsoft.ML.Trainers.LbfgsTrainerBase`3.DifferentiableFunctionMultithreaded(VBuffer`1& xDense, VBuffer`1& gradient, IProgressChannel pch) in /machinelearning/src/Microsoft.ML.StandardTrainers/Standard/LogisticRegression/LbfgsPredictorBase.cs:line 698\r\n   at Microsoft.ML.Trainers.LbfgsTrainerBase`3.DifferentiableFunction(VBuffer`1& x, VBuffer`1& gradient, IProgressChannelProvider progress) in /machinelearning/src/Microsoft.ML.StandardTrainers/Standard/LogisticRegression/LbfgsPredictorBase.cs:line 641\r\n   at Microsoft.ML.Numeric.L1Optimizer.L1OptimizerState.EvalCore(VBuffer`1& input, VBuffer`1& gradient, IProgressChannelProvider progress) in /machinelearning/src/Microsoft.ML.StandardTrainers/Optimizer/L1Optimizer.cs:line 119\r\n   at Microsoft.ML.Numeric.Optimizer.OptimizerState.Init() in /machinelearning/src/Microsoft.ML.StandardTrainers/Optimizer/Optimizer.cs:line 241\r\n   at Microsoft.ML.Numeric.L1Optimizer.MakeState(IChannel ch, IProgressChannelProvider progress, DifferentiableFunction function, VBuffer`1& initial) in /machinelearning/src/Microsoft.ML.StandardTrainers/Optimizer/L1Optimizer.cs:line 59\r\n   at Microsoft.ML.Numeric.Optimizer.Minimize(DifferentiableFunction function, VBuffer`1& initial, ITerminationCriterion term, VBuffer`1& result, Single& optimum) in /machinelearning/src/Microsoft.ML.StandardTrainers/Optimizer/Optimizer.cs:line 611\r\n   at Microsoft.ML.Trainers.LbfgsTrainerBase`3.TrainCore(IChannel ch, RoleMappedData data) in /machinelearning/src/Microsoft.ML.StandardTrainers/Standard/LogisticRegression/LbfgsPredictorBase.cs:line 573\r\n   at Microsoft.ML.Trainers.LbfgsTrainerBase`3.TrainModelCore(TrainContext context) in /machinelearning/src/Microsoft.ML.StandardTrainers/Standard/LogisticRegression/LbfgsPredictorBase.cs:line 433\r\n   at Microsoft.ML.Trainers.TrainerEstimatorBase`2.Microsoft.ML.ITrainer<Microsoft.ML.IPredictor>.Train(TrainContext context) in /machinelearning/src/Microsoft.ML.Data/Training/TrainerEstimatorBase.cs:line 100\r\n   at Microsoft.ML.Data.TrainUtils.TrainCore(IHostEnvironment env, IChannel ch, RoleMappedData data, ITrainer trainer, RoleMappedData validData, IComponentFactory`1 calibrator, Int32 maxCalibrationExamples, Nullable`1 cacheData, IPredictor inputPredictor, RoleMappedData testData) in /machinelearning/src/Microsoft.ML.Data/Commands/TrainCommand.cs:line 280\r\n   at Microsoft.ML.Data.TrainTestCommand.RunCore(IChannel ch, String cmd) in /machinelearning/src/Microsoft.ML.Data/Commands/TrainTestCommand.cs:line 186\r\n   at Microsoft.ML.Data.TrainTestCommand.Run() in /machinelearning/src/Microsoft.ML.Data/Commands/TrainTestCommand.cs:line 108\r\n   at Microsoft.ML.Tools.Maml.MainCore(IHostEnvironment env, String args, Boolean alwaysPrintStacktrace) in /machinelearning/src/Microsoft.ML.Maml/MAML.cs:line 142\r\n```\r\n\r\n- **What did you expect?**\r\nWe expect a trained model, not this error. \r\n\r\n### Source code / logs\r\n\r\nPlease paste or attach the code or logs or traces that would be helpful to diagnose the issue you are reporting.\r\nDocker file: \r\n```\r\nFROM mcr.microsoft.com/dotnet/core/sdk:3.1 AS builder\r\n\r\nRUN apt-get update \r\nRUN apt-get install -y git cmake clang-3.9 libomp-dev\r\nRUN git clone https://github.com/dotnet/machinelearning.git\r\n\r\nRUN cd /machinelearning &&\\\r\n    git submodule update --init &&\\\r\n    bash build.sh -release\r\n\r\n\r\nRUN mkdir /mlnet_ &&\\\r\n    dotnet publish -c Release --no-build  machinelearning/src/Microsoft.ML.Console --output mlnet_ --self-contained false\r\n\r\nRUN mkdir /mlnet &&\\\r\n    cp -RL /mlnet_/* /mlnet/\r\n\r\n# RUN cp -r /mlnet /mlnet_all\r\n\r\nRUN rm -rf /mlnet/runtimes/osx-x64 &&\\\r\n    rm -rf /mlnet/runtimes/win &&\\\r\n    rm -rf /mlnet/runtimes/win-x64 &&\\\r\n    rm -rf /mlnet/runtimes/win-x86\r\n\r\n\r\n\r\nFROM mcr.microsoft.com/azureml/o16n-sample-user-base/ubuntu-miniconda\r\n\r\nRUN apt-get update &&\\\r\n    apt-get install -y apt-transport-https fuse\r\n\r\nRUN wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.asc.gpg\r\nRUN mv microsoft.asc.gpg /etc/apt/trusted.gpg.d/\r\nRUN chown root:root /etc/apt/trusted.gpg.d/microsoft.asc.gpg\r\n\r\nRUN wget -q https://packages.microsoft.com/config/debian/10/prod.list\r\nRUN mv prod.list /etc/apt/sources.list.d/microsoft-prod.list\r\nRUN chown root:root /etc/apt/sources.list.d/microsoft-prod.list\r\n\r\nRUN apt-get update &&\\\r\n    apt-get install -y dotnet-runtime-2.1\r\n\r\nCOPY --from=builder /mlnet /mlnet/.\r\n\r\nRUN ldconfig -n /mlnet\r\nENV LD_LIBRARY_PATH=/mlnet/runtimes/linux-x64/native:/mlnet/runtimes/unix/lib/netcoreapp2.0:$LD_LIBRARY_PATH\r\n```","Url":"https://github.com/dotnet/machinelearning/issues/5299","RelatedDescription":"Closed issue \"Unable to load shared library 'CpuMathNative' or one of its dependencies.\" (#5299)"},{"Id":"655296361","IsPullRequest":false,"CreatedAt":"2020-07-14T13:32:22","Actor":"JuanJimenezR","Number":"5304","RawContent":null,"Title":"Error al llamar \"ITransformer mlModel = mlContext.Model.Load(modelPath, out var modelInputSchema);\"             ","State":"closed","Body":"### System information\r\n\r\n- **OS Microsoft Win 10\r\n- **.NET Version 2019: \r\n\r\n\r\n- **What did you do?**\r\nEstoy generando código con ML.builder.  De hecho he logrado generar y ejecutar con exito un par de modelos donde el modelo propuesto por ML.Builder fue un fasttree.\r\nPara este nuevo set de datos el modelo generado el  el  ML.Builder fue el OlsRegression . Fue agregado el código al proyecto.  \r\nHe a actualizado las librerias incluidas a la version 1.0.0 , pues me lo pidió igual que los casos anteriores.\r\n\r\nEstoy cargando con exito los datos en el ModelInput\r\nEstoy llamando a ConsumeModel.Predict ... dando el problema técnico mencionado  en la llamada\r\n\r\nITransformer mlModel = mlContext.Model.Load(modelPath, out var modelInputSchema);\r\n            .\r\nde la clase consumeModel.\r\n\r\nHe vuelto a iniciar de cero, para descartar que por alguna X razón el  modelo .zip estuviese corrupto, PERO tengo el mismo resultado.\r\n\r\n- **What happened?**\r\n\r\n- **What did you expect?**\r\naclaro ya he generado  y utilizado otros modelos, los cuales suelen funcionar luego de hacer las actualizaciones a las librerías y los amarres de código respectivos.  Pero  en este caso ... persiste el  error, en vez de poder hacer UNA prediccion \r\n\r\n### Source code / logs\r\n\r\n### System.InvalidOperationException\r\n  HResult=0x80131509\r\n  Mensaje = Error during class instantiation\r\n  Origen = Microsoft.ML.Core\r\n  Seguimiento de la pila:\r\n   at Microsoft.ML.Runtime.ComponentCatalog.LoadableClassInfo.CreateInstanceCore(Object[] ctorArgs)\r\n   at Microsoft.ML.Runtime.ComponentCatalog.TryCreateInstance[TRes](IHostEnvironment env, Type signatureType, TRes& result, String name, String options, Object[] extra)\r\n   at Microsoft.ML.Runtime.ComponentCatalog.TryCreateInstance[TRes,TSig](IHostEnvironment env, TRes& result, String name, String options, Object[] extra)\r\n   at Microsoft.ML.ModelLoadContext.TryLoadModelCore[TRes,TSig](IHostEnvironment env, TRes& result, Object[] extra)\r\n   at Microsoft.ML.ModelLoadContext.TryLoadModel[TRes,TSig](IHostEnvironment env, TRes& result, RepositoryReader rep, Entry ent, String dir, Object[] extra)\r\n   at Microsoft.ML.ModelLoadContext.LoadModel[TRes,TSig](IHostEnvironment env, TRes& result, RepositoryReader rep, Entry ent, String dir, Object[] extra)\r\n   at Microsoft.ML.ModelLoadContext.LoadModelOrNull[TRes,TSig](IHostEnvironment env, TRes& result, RepositoryReader rep, String dir, Object[] extra)\r\n   at Microsoft.ML.ModelLoadContext.LoadModel[TRes,TSig](IHostEnvironment env, TRes& result, RepositoryReader rep, String dir, Object[] extra)\r\n   at Microsoft.ML.ModelOperationsCatalog.Load(Stream stream, DataViewSchema& inputSchema)\r\n   at Microsoft.ML.ModelOperationsCatalog.Load(String filePath, DataViewSchema& inputSchema)\r\n   at PaLanteML.Model.ConsumeModel.CreatePredictionEngine() in D:\\Toni\\Soluciones\\PaLante\\PaLanteML.Model\\ConsumeModel.cs:line 31\r\n   at System.Lazy`1.CreateValue()\r\n\r\nEsta excepción se generó originalmente en esta pila de llamadas:\r\n    [Código externo]\r\n\r\nExcepción interna 1:\r\nTargetInvocationException: Se produjo una excepción en el destino de la invocación.\r\n\r\nExcepción interna 2:\r\nInvalidOperationException: Error during class instantiation\r\n\r\nExcepción interna 3:\r\nTargetInvocationException: Se produjo una excepción en el destino de la invocación.\r\n\r\nExcepción interna 4:\r\nFormatException: Uno de los elementos identificados tiene un formato no válido.\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/issues/5304","RelatedDescription":"Closed issue \"Error al llamar \"ITransformer mlModel = mlContext.Model.Load(modelPath, out var modelInputSchema);\"             \" (#5304)"},{"Id":"656468317","IsPullRequest":false,"CreatedAt":"2020-07-14T09:26:46","Actor":"misaqsaadat","Number":"5306","RawContent":null,"Title":"Index out of range exception in execute","State":"open","Body":"### System information\r\n\r\nwindows 10 version 1803\r\nNET Version (3.1.300): \r\nAutoML version : 0.17.1\r\n(also tested on version 0.14.0)\r\n### Issue\r\n\r\nI am trying to use AutoML for the first time. but I get IndexOutOfRangeException on execute method call.\r\n\r\n### Source code / logs\r\nstatic void Main(string[] args)\r\n\t\t{\r\n\t\t\tMLContext mlContext = new MLContext();\r\n\t\t\tIDataView trainDataView = mlContext.Data.LoadFromTextFile<ModelInput>(\"input.csv\", hasHeader: true);\r\n\t\t\tvar experimentSettings = new RegressionExperimentSettings();\r\n\t\t\texperimentSettings.MaxExperimentTimeInSeconds = 100;\r\n\t\t\tRegressionExperiment experiment = mlContext.Auto().CreateRegressionExperiment(experimentSettings);\r\n\t\t\tExperimentResult<RegressionMetrics> experimentResult = experiment.Execute(trainDataView, \"Withdrawal\");\r\n\t\t\tRegressionMetrics metrics = experimentResult.BestRun.ValidationMetrics;\r\n\t\t\tConsole.WriteLine($\"R-Squared: {metrics.RSquared:0.##}\");\r\n\t\t\tConsole.WriteLine($\"Root Mean Squared Error: {metrics.RootMeanSquaredError:0.##}\");\r\n\t\t}\r\n\r\nError:\r\n\r\nUnhandled exception. System.ArgumentOutOfRangeException: Index was out of range. Must be non-negative and less than the size of the collection. (Parameter 'index')\r\n   at Microsoft.ML.AutoML.CrossValSummaryRunner`1.Run(SuggestedPipeline pipeline, DirectoryInfo modelDirectory, Int32 iterationNum)\r\n   at Microsoft.ML.AutoML.Experiment`2.Execute()\r\n   at Microsoft.ML.AutoML.ExperimentBase`2.Execute(ColumnInformation columnInfo, DatasetColumnInfo[] columns, IEstimator`1 preFeaturizer, IProgress`1 progressHandler, IRunner`1 runner)\r\n   at Microsoft.ML.AutoML.ExperimentBase`2.ExecuteCrossValSummary(IDataView[] trainDatasets, ColumnInformation columnInfo, IDataView[] validationDatasets, IEstimator`1 preFeaturizer, IProgress`1 progressHandler)\r\n   at Microsoft.ML.AutoML.ExperimentBase`2.Execute(IDataView trainData, ColumnInformation columnInformation, IEstimator`1 preFeaturizer, IProgress`1 progressHandler)\r\n   at Microsoft.ML.AutoML.ExperimentBase`2.Execute(IDataView trainData, String labelColumnName, String samplingKeyColumn, IEstimator`1 preFeaturizer, IProgress`1 progressHandler)\r\n   at FunWithMlnet.Program.Main(String[] args) in C:\\Users\\User\\source\\repos\\FunWithWithdrawalsData\\FunWithMlnet\\Program.cs:line 18","Url":"https://github.com/dotnet/machinelearning/issues/5306","RelatedDescription":"Open issue \"Index out of range exception in execute\" (#5306)"},{"Id":"655122348","IsPullRequest":true,"CreatedAt":"2020-07-11T05:02:45","Actor":"harishsk","Number":"5302","RawContent":null,"Title":"Updated version to 1.5.2","State":"closed","Body":"","Url":"https://github.com/dotnet/machinelearning/pull/5302","RelatedDescription":"Closed or merged PR \"Updated version to 1.5.2\" (#5302)"},{"Id":"654434456","IsPullRequest":true,"CreatedAt":"2020-07-11T02:51:26","Actor":"harishsk","Number":"5297","RawContent":null,"Title":"Release notes for v1.5.1","State":"closed","Body":"","Url":"https://github.com/dotnet/machinelearning/pull/5297","RelatedDescription":"Closed or merged PR \"Release notes for v1.5.1\" (#5297)"},{"Id":"655059377","IsPullRequest":true,"CreatedAt":"2020-07-11T00:33:31","Actor":"antoniovs1029","Number":"5301","RawContent":null,"Title":"Improve VectorTypeAttribute(dims) docs","State":"closed","Body":"Addresses #5273 : On the confusion of users about how to use the VectorTypeAttribute.\r\n\r\nAs confirmed offline by @yaeldekel , users currently can't provide a multidimensional array with a `VectorTypeAttribute(dims)` . They should flatten their arrays into 1-D arrays and then use the `VectorTypeAttribute(dims)` to describe the shape ML.NET will use internally.\r\n\r\n**Note:** Originally I was planning on throwing a readable exception if the user added the `VectorTypeAttribute` to a multidimensional array, but some discussion would be needed to decide where to do this (either in `InternalSchemaDefinition.Create`, or somewhere else on `InternalSchemaDefinition` or `SchemaDefinition` itself). Furthermore, I'm thinking that maybe there's a bug on these classes, where if a user adds a custom `DataViewType` (see #3263 ) and adds the attribute of this type to an array, then some unexpected behavior will happen as [`InternalSchemaDefinition.GetMappedType()` ](https://github.com/antoniovs1029/machinelearning/blob/bb13d629000c218136e741b643767cf45ae12fc4/src/Microsoft.ML.Data/DataView/InternalSchemaDefinition.cs#L163) assumes that any array (multidimensional or otherwise) is `isVector = true`, and then elsewhere in the code we assume that if a type `isVector == true` then it _should_ be a `VectorDataViewType`. More discussion and inspection would be needed on this regard and it might, or not, affect the decision of where to throw an exception for multidimensionals array with `VectorTypeAttribute`. And these may be addressed on a separate PR.\r\n\r\nSo, for the time being, and the fact that this might not be a common problem anyway, I think that simply changing slightly the docs is the best option for the next release.","Url":"https://github.com/dotnet/machinelearning/pull/5301","RelatedDescription":"Closed or merged PR \"Improve VectorTypeAttribute(dims) docs\" (#5301)"},{"Id":"653856686","IsPullRequest":true,"CreatedAt":"2020-07-10T23:35:10","Actor":"antoniovs1029","Number":"5296","RawContent":null,"Title":"Update OnnxTransformer Docs","State":"closed","Body":"* Address https://github.com/dotnet/machinelearning/issues/5262#issuecomment-650256576 : Users find it confusing not knowing where to find the info related to the dependencies of Onnx and how to make it work on the GPU. So I think it's best to keep this info in the docs of the `OnnxScoringEstimator` and add a note on every `ApplyOnnxModel()` overload and to `OnnxTransformer` pointing to the Estimator's docs.\r\n\r\n* Address #5293 : About the confusing nature of the `shapeDictionary` parameter. I've updated the docs for this parameter based on the explicit suggestion made by the user.\r\n\r\n* Added a couple of details about how the `gpuDeviceId` and `fallbackToCpu` interact with each other.\r\n\r\n**Note:** As stated in https://github.com/dotnet/machinelearning/issues/5262#issuecomment-650256576 for some reason the published docs for [OnnxTransformer](https://docs.microsoft.com/en-us/dotnet/api/microsoft.ml.transforms.onnx.onnxtransformer?view=ml-dotnet) are outdated, and for some reason it includes info that was deleted on the ML.NET 1.5.0 release (or maybe before that). @natke thinks this is a bug in the tools that generate the published docs, and is seeking for help on this, as this tools are outside of the ML.NET repo itself. In the meantime, we'll try to see if updating this docs on this PR will force the tool to actually generate the correct updated docs.\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/pull/5296","RelatedDescription":"Closed or merged PR \"Update OnnxTransformer Docs\" (#5296)"},{"Id":"654621086","IsPullRequest":true,"CreatedAt":"2020-07-10T08:45:46","Actor":"mstfbl","Number":"5298","RawContent":null,"Title":"Added IsotonicCalibrator ONNX Export Support","State":"open","Body":"WIP PR to add ONNX export support for the Isotonic Calibrator\r\n\r\nCurrent work remaining is implementing if-then-else conditionals. Intermediate calculations and if-then-else inputs are already implemented.\r\n\r\nI will add tests (first written in this [commit](https://github.com/dotnet/machinelearning/pull/5289/commits/b27d278708beed87d0e7131a58f7fe16abad3f3f)) for validating IsotonicCalibrator with ONNX and merge with upstream once PR #5289 is merged.\r\n\r\n","Url":"https://github.com/dotnet/machinelearning/pull/5298","RelatedDescription":"Open PR \"Added IsotonicCalibrator ONNX Export Support\" (#5298)"},{"Id":"653124819","IsPullRequest":false,"CreatedAt":"2020-07-10T00:11:38","Actor":"jwood803","Number":"5294","RawContent":null,"Title":"\"Could not find operation\" Error When Scoring a Tensorflow Model","State":"closed","Body":"### System information\r\n\r\n- **OS version/distro**:\r\nWindows 10 1909 Build \r\n- **.NET Version (eg., dotnet --info)**: \r\n.NET Core SDK (reflecting any global.json):\r\n Version:   3.1.400-preview-015178\r\n Commit:    60cb58d3b1\r\n\r\nRuntime Environment:\r\n OS Name:     Windows\r\n OS Version:  10.0.18363\r\n OS Platform: Windows\r\n RID:         win10-x64\r\n Base Path:   C:\\Program Files\\dotnet\\sdk\\3.1.400-preview-015178\\\r\n\r\nHost (useful for support):\r\n  Version: 3.1.2\r\n  Commit:  916b5cba26\r\n\r\n.NET Core SDKs installed:\r\n  3.0.100-preview8-013656 [C:\\Program Files\\dotnet\\sdk]\r\n  3.1.400-preview-015178 [C:\\Program Files\\dotnet\\sdk]\r\n\r\n.NET Core runtimes installed:\r\n  Microsoft.AspNetCore.App 3.0.0-preview8.19405.7 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n  Microsoft.AspNetCore.App 3.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n  Microsoft.DesktopUI.App 3.0.0-alpha-26921-3 [C:\\Program Files\\dotnet\\shared\\Microsoft.DesktopUI.App]\r\n  Microsoft.NETCore.App 3.0.0-preview8-28405-07 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 3.1.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 3.1.1 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 3.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.WindowsDesktop.App 3.0.0-preview8-28405-07 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\r\n  Microsoft.WindowsDesktop.App 3.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\r\n\r\n### Issue\r\n\r\n- **What did you do?**\r\nAttempted to load and score a Tensorflow model.\r\n\r\n- **What happened?**\r\nWhen running it gave a 'Could not find operation \"input\" inside graph \"grap-key-1/\".' error.\r\n\r\n### Source code / logs\r\nUsed [this Colab notebook](https://colab.research.google.com/github/tensorflow/docs/blob/master/site/en/tutorials/quickstart/beginner.ipynb) locally and added the `model.save(\"mnist-model.h5\", save_format=\"h5\")` line to save the model to a local file.\r\n\r\nThe model as shown in Netron:\r\n![image](https://user-images.githubusercontent.com/1578160/86899782-719ffa00-c0d8-11ea-9d9d-1363c88daaaa.png)\r\n\r\nUsed the below ML.NET code to load and score the model:\r\n\r\n```csharp\r\npublic class DigitInput\r\n{\r\n    public float[] DigitData { get; set; }\r\n}\r\n\r\nvar context = new MLContext();\r\n\r\nvar emptyData = new List<DigitInput>();\r\n\r\nvar data = context.Data.LoadFromEnumerable(emptyData);\r\n\r\nvar pipeline = context.Model.LoadTensorFlowModel(\"./mnist-model.h5\")\r\n  .ScoreTensorFlowModel(new[] { \"dense_1\" }, new[] { \"input\" }, addBatchDimensionInput: true)\r\n  .Append(context.MulticlassClassification.Trainers.LbfgsMaximumEntropy(\"LabelKey\", \"dense_1\"))\r\n  .Append(context.Transforms.Conversion.MapKeyToValue(\"PredictedLabelValue\", \"PredictedLabel\"));\r\n\r\npipeline.Fit(data);\r\n```\r\n\r\nI'm sure I'm missing something but not sure what that is. 😄 ","Url":"https://github.com/dotnet/machinelearning/issues/5294","RelatedDescription":"Closed issue \"\"Could not find operation\" Error When Scoring a Tensorflow Model\" (#5294)"}],"ResultType":"GitHubIssue"}},"RunOn":"2020-07-26T05:30:38.1396035Z","RunDurationInMilliseconds":743}